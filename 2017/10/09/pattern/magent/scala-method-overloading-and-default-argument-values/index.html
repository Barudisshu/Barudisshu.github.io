<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>Scala Method Overloading and Default Argument Values</title><link rel="stylesheet" href="/css/layout.css">
<!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css"><link rel="shortcut icon" href="/img/favicon.ico"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">简单易懂の现代魔法</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="http://weibo.com/u/2360401155" class="menu-link">Weibo</a></li><li class="menu-item"><a href="/about" class="menu-link">About</a></li><li class="menu-item"><a href="/atom.xml" class="menu-link">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">简单易懂の现代魔法</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="http://weibo.com/u/2360401155" class="menu-link">Weibo</a></li><li class="menu-item"><a href="/about" class="menu-link">About</a></li><li class="menu-item"><a href="/atom.xml" class="menu-link">Rss</a></li></ul></nav><div id="mobile-menu-toggle" class="toggle-menu"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">Scala Method Overloading and Default Argument Values</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2017-10-09</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a href="/tags/scala-magent-implicits-typeclasses/" class="tag-link">scala, magent, implicits, typeclasses</a></p></div><div class="article-content"><p>Using the magent pattern to get around a limitation with Scala’s overloading implementation.</p>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><a id="more"></a>
<p>I was writing some code recently that wanted to do this(somewhat contrived to simplify the example):</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set</span></span>(key: <span class="type">String</span>, value: <span class="type">String</span>)(<span class="keyword">implicit</span> ttl: <span class="type">Duration</span> = <span class="number">1.</span>hour): <span class="type">Int</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set</span></span>(key: <span class="type">String</span>, value: <span class="type">ByteString</span>)(<span class="keyword">implicit</span> ttl: <span class="type">Duration</span> = <span class="number">2.</span>hour): <span class="type">Int</span></span><br></pre></td></tr></table></figure>
<p>There’s some specific detail about how the <a href="http://scala-lang.org/" target="_blank" rel="noopener">Scala</a> compiler implements default values for method parameters - that I havent’t investigated and probalby wouldn’t understand anyway - that makes it say the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">... multiple overloaded alternatives of method <span class="built_in">set</span> define default arguments.</span><br></pre></td></tr></table></figure>
<p>There’s clearly a way around this problem; don’t overload. So, I turned to the <a href="http://spray.io/blog/2012-12-13-the-magnet-pattern/" target="_blank" rel="noopener">magnet pattern</a> as popularized by the <a href="http://spray.io/" target="_blank" rel="noopener">Spray</a> library. It’s really just a specialized use for type classes that carries a cool name so it’s easy to talk about and reference. My use of the pattern, in this case, is even simpler because the return type of the method doesn’t vary with the magent instance. At any rate, here’s the deal:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">ByteStringMagnet</span> </span>&#123;</span><br><span class="line">  <span class="keyword">val</span> bs: <span class="type">ByteString</span></span><br><span class="line">  <span class="keyword">val</span> ttl: <span class="type">Duration</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(f: (<span class="type">ByteString</span>, <span class="type">Duration</span>) =&gt; <span class="type">Int</span>): <span class="type">Int</span> = f(bs, ttl)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ByteStringMagnet</span> </span>&#123;</span><br><span class="line">  <span class="keyword">import</span> language.implicitConversions</span><br><span class="line"></span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">fromString</span></span>(s: <span class="type">String</span>)(<span class="keyword">implicit</span> ttlive: <span class="type">Duration</span> = <span class="number">1.</span>hour): <span class="type">ByteStringMagnet</span> = <span class="keyword">new</span> <span class="type">ByteStringMagnet</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> ttl = ttlive</span><br><span class="line">    <span class="keyword">val</span> bs = <span class="type">ByteString</span>(s)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">fromByteString</span></span>(bytes: <span class="type">ByteString</span>)(<span class="keyword">implicit</span> ttlive: <span class="type">Duration</span> = <span class="number">2.</span>hours): <span class="type">ByteStringMagnet</span> = <span class="keyword">new</span> <span class="type">ByteStringMagnet</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> ttl = ttlive</span><br><span class="line">    <span class="keyword">val</span> bs = bytes</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Main</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** * Now we have only one instance of the `set` method; the magnet pattern takes * care of pulling the various types down into the argument. */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">set</span></span>(key: <span class="type">String</span>, magnet: <span class="type">ByteStringMagnet</span>): <span class="type">Int</span> =</span><br><span class="line">    magnet &#123; (value, ttl) =&gt;</span><br><span class="line">      println(<span class="string">s"<span class="subst">$ttl</span>"</span>)</span><br><span class="line">      <span class="number">5</span></span><br><span class="line">      <span class="comment">// Do something with the ByteString value and return an Int       5</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  set(<span class="string">"key"</span>, <span class="string">"str"</span>)</span><br><span class="line">  set(<span class="string">"key"</span>, <span class="type">ByteString</span>(<span class="string">"str"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Problem solved. The implicit conversions are resolved nicely because they’re right on the <code>ByteStringMagnet</code> and, in general, you should never have to define an implicit conversion anywhere else (unless of course you need to extend the functionality from outside of the library).</p>
</div></article><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2017/10/09/pattern/magent/scala-method-overloading-and-default-argument-values/';
var disqus_title = 'Scala Method Overloading and Default Argument Values';
var disqus_url = 'http://galudisu.info/2017/10/09/pattern/magent/scala-method-overloading-and-default-argument-values/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//barudisshu-github-io.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>©2016 - 2019 <a href="http://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready"><script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css"><script src="/js/base.js"></script><script src="/js/rabbit-lyrics.js"></script></div><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>