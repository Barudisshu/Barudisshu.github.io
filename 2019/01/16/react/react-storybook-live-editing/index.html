<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>使用storybook开发自己的React组件库</title><link rel="stylesheet" href="/css/layout.css">
<!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css"><link rel="shortcut icon" href="/img/favicon.ico"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">简单易懂の现代魔法</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="http://weibo.com/u/2360401155" class="menu-link">Weibo</a></li><li class="menu-item"><a href="/about" class="menu-link">About</a></li><li class="menu-item"><a href="/atom.xml" class="menu-link">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">简单易懂の现代魔法</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="http://weibo.com/u/2360401155" class="menu-link">Weibo</a></li><li class="menu-item"><a href="/about" class="menu-link">About</a></li><li class="menu-item"><a href="/atom.xml" class="menu-link">Rss</a></li></ul></nav><div id="mobile-menu-toggle" class="toggle-menu"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">使用storybook开发自己的React组件库</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2019-01-16</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tag"> </i><a href="/tags/react-redux-webpack-hot/" class="tag-link">react, redux, webpack, hot</a></p></div><div class="article-content"><p><img src="/img/cartoon/20190116_225744.925.jpg" alt="ohanahibi"><br>
<!-- hexo-inject:begin --><!-- hexo-inject:end -->有时候并不希望使用第三方组件库，以及大部分时候需要自己定制一套组件实现，以供公司或项目内部使用。开发自己的组件有如重复造轮子，会花费相当多的精力制造。如果是为了一种长远公司发展，这份努力是值得的，如果不想自己耗费精力，也有许多开源的组件实现，比如<a href="https://material-ui.com/" target="_blank" rel="noopener">material-ui</a>。一般都是拿来改造一下，可以避免很多开发或兼容性上的坑。</p>
<a id="more"></a>
<h2><span id="architecture">Architecture</span></h2>
<p>编写这篇文章时，笔者用的都是最新的包以及依赖，坑比较多，比如<a href="https://webpack.js.org/" target="_blank" rel="noopener">webpack4</a>，改掉以及删除很多功能；又如<a href="https://babeljs.io/docs/en/v7-migration" target="_blank" rel="noopener">babel7</a>弃用了旧的写法，全部带上了<code>scoped packages</code>，即在presets前面带上模块标志：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  presets: [<span class="string">"@babel/env"</span>], <span class="comment">// "@babel/preset-env"</span></span><br><span class="line">  plugins: [<span class="string">"@babel/transform-arrow-functions"</span>], <span class="comment">// same as "@babel/plugin-transform-arrow-functions"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>主要关键技术：</p>
<ul>
<li>webpack</li>
<li>typescript</li>
<li>react</li>
<li>state management(redux or mobx)</li>
<li>react-router-4</li>
<li>component hot reload</li>
<li>svg icon</li>
<li>jest</li>
<li>UI lib</li>
<li>less</li>
<li>eslint</li>
</ul>
<p>主要库以及版本：</p>
<ul>
<li>webpack			4.x.x</li>
<li>typescript		2.9.x</li>
<li>react				16.7.x</li>
<li>react-router-dom	4.2.x</li>
<li>react-hot-loader	4.6.x<br>
…</li>
<li>node				10.13.x</li>
</ul>
<p>注意：react-router v4为第四代react-router，react-dom为v2或v3的旧版本。新版本的react-router v4可以说是重写了路由，react-router v4 被一分为三：<code>react-router-dom</code>(for web)、<code>react-router-native</code>(for native)、<code>react-router</code>(core)。仅在浏览器中使用的话，一般引入<code>react-router-dom</code>即可。如果从旧版本迁移，可以参考<a href="https://github.com/gmfe/Think/issues/6" target="_blank" rel="noopener">这里</a>。</p>
<p>目录结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--.storybook</span><br><span class="line">--public			模板目录</span><br><span class="line">--src</span><br><span class="line">  --components 		自定义组件</span><br><span class="line">  --docs			代码入口&lt;App/&gt;</span><br><span class="line">  --stories			文档说明</span><br><span class="line">eslintrc.yml</span><br><span class="line">tsconfig.json</span><br><span class="line">.babelrc</span><br><span class="line">package.json		依赖包</span><br><span class="line">webpack.config.js</span><br></pre></td></tr></table></figure>
<h2><span id="babel">Babel</span></h2>
<p>Babel用于将浏览器不能识别的ES以及TS转换为JS，首先添加依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev @babel/core @babel/cli @babel/preset-env @babel/preset-react @babel/preset-typescript @babel/plugin-proposal-object-rest-spread @babel/plugin-transform-runtime</span><br></pre></td></tr></table></figure>
<p>然后在根目录添加.babelrc，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    &quot;@babel/preset-env&quot;,</span><br><span class="line">    &quot;@babel/preset-react&quot;,</span><br><span class="line">    &quot;@babel/preset-typescript&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    &quot;@babel/plugin-proposal-object-rest-spread&quot;,</span><br><span class="line">    &quot;@babel/plugin-transform-runtime&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="unit-test">Unit Test</span></h2>
<p>添加单元测试，单测默认识别目录<code>__tests__</code>，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--src</span><br><span class="line">  --components</span><br><span class="line">    --Link</span><br><span class="line">	  --__tests__</span><br><span class="line">	    Link.react.test.js</span><br><span class="line">	  Link.react.js</span><br><span class="line">    index.js</span><br></pre></td></tr></table></figure>
<p>首先，使用TypeScript编写一个组件，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> STATUS = &#123;</span><br><span class="line">  HOVERED: <span class="string">'hovered'</span>,</span><br><span class="line">  NORMAL: <span class="string">'normal'</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">MLink</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>._onMouseEnter = <span class="keyword">this</span>._onMouseEnter.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>._onMouseLeave = <span class="keyword">this</span>._onMouseLeave.bind(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      class: STATUS.NORMAL,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _onMouseEnter() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">class</span>: STATUS.HOVERED &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _onMouseLeave() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">class</span>: STATUS.NORMAL &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;a</span><br><span class="line">        className=&#123;<span class="keyword">this</span>.state.class&#125;</span><br><span class="line">        href=&#123;<span class="keyword">this</span>.props.page || <span class="string">'#'</span>&#125;</span><br><span class="line">        onMouseEnter=&#123;<span class="keyword">this</span>._onMouseEnter&#125;</span><br><span class="line">        onMouseLeave=&#123;<span class="keyword">this</span>._onMouseLeave&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.props.children&#125;</span><br><span class="line">      &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">MLink.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  children: PropTypes.node.isRequired,</span></span><br><span class="line"><span class="regexp">  page: PropTypes.node,</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>对应其<code>__tests__</code>目录添加单元测试，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MLink.react.test.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; MLink &#125; <span class="keyword">from</span> <span class="string">'../Link.react'</span>;</span><br><span class="line"><span class="keyword">import</span> renderer <span class="keyword">from</span> <span class="string">'react-test-renderer'</span>;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'MLink changes the class when hovered'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> component = renderer.create(</span><br><span class="line">    &lt;MLink page=<span class="string">"http://www.facebook.com"</span>&gt;Facebook&lt;<span class="regexp">/MLink&gt;,</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">  let tree = component.toJSON();</span></span><br><span class="line"><span class="regexp">  expect(tree).toMatchSnapshot();</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ manually trigger the callback</span></span><br><span class="line"><span class="regexp">  tree.props.onMouseEnter();</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ re-rendering</span></span><br><span class="line"><span class="regexp">  tree = component.toJSON();</span></span><br><span class="line"><span class="regexp">  expect(tree).toMatchSnapshot();</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ manually trigger the callback</span></span><br><span class="line"><span class="regexp">  tree.props.onMouseLeave();</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ re-rendering</span></span><br><span class="line"><span class="regexp">  tree = component.toJSON();</span></span><br><span class="line"><span class="regexp">  expect(tree).toMatchSnapshot();</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure>
<p>把单元测试所需的配置补充上，添加单元测试所需要的依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev jest @types/jest babel-jest ts-jest</span><br></pre></td></tr></table></figure>
<p>另外还需要一个Enzyme，它是React的测试工具，还需要enzyme-to-json 转换，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev jest react-test-renderer enzyme enzyme-adapter-react-16 enzyme-to-json</span><br></pre></td></tr></table></figure>
<p>更新一下package.json，加上对应的脚本</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "test": "jest",</span><br><span class="line">  "test:watch": "jest --watch",</span><br><span class="line">  "test:coverage": "jest --coverage"</span><br><span class="line">&#125;,</span><br><span class="line">"jest": &#123;</span><br><span class="line">  "setupFiles": ["./test/jestsetup.js"],</span><br><span class="line">  "snapshotSerializers": ["enzyme-to-json/serializer"]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建一个test/jestsetup.js文件，自定义测试环境</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Enzyme, &#123; shallow, render, mount &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> Adapter <span class="keyword">from</span> <span class="string">'enzyme-adapter-react-16'</span>;</span><br><span class="line"><span class="comment">// React 16 Enzyme adapter</span></span><br><span class="line">Enzyme.configure(&#123; <span class="attr">adapter</span>: <span class="keyword">new</span> Adapter() &#125;);</span><br><span class="line"><span class="comment">// Make Enzyme functions available in all test files without importing</span></span><br><span class="line">global.shallow = shallow;</span><br><span class="line">global.render = render;</span><br><span class="line">global.mount = mount;</span><br></pre></td></tr></table></figure>
<p>对于CSS模块，添加以下配置到package.json</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"jest": &#123;</span><br><span class="line">  "moduleNameMapper": &#123;</span><br><span class="line">    "^.+\\.(css|scss)$": "identity-obj-proxy"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行命令进行测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jest --env=jsdom --coverage --no-cache --detectOpenHandles</span><br></pre></td></tr></table></figure>
<p>jest可以测试的特性有：</p>
<ul>
<li>component render</li>
<li>props</li>
<li>events</li>
<li>event handlers<br>
…</li>
</ul>
<p>更多例子可以参考<a href="https://jestjs.io/" target="_blank" rel="noopener">这里</a>。</p>
<h2><span id="eslint">ESLint</span></h2>
<p>首先加入依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev eslint eslint-config-airbnb-base eslint-loader eslint-plugin-import eslint-plugin-react typescript-eslint-parser</span><br></pre></td></tr></table></figure>
<p>ESLint用于代码检查用，配置也比较无脑，当你用像WebStorm这些开发工具时，工具会自动检测到ESLint，自动为你格式化和检查代码。下面是我自己的一份配置：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line"><span class="attr">  browser:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  commonjs:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  es6:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  jest:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">ecmaFeatures:</span></span><br><span class="line"><span class="attr">  modules:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  spread:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  restParams:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">extends:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">'eslint:recommended'</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">'plugin:react/recommended'</span></span><br><span class="line"><span class="attr">parser:</span> <span class="string">'babel-eslint'</span></span><br><span class="line"><span class="attr">parserOptions:</span></span><br><span class="line"><span class="attr">  ecmaFeatures:</span></span><br><span class="line"><span class="attr">    jsx:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  ecmaVersion:</span> <span class="number">2018</span></span><br><span class="line"><span class="attr">  sourceType:</span> <span class="string">module</span></span><br><span class="line"><span class="attr">plugins:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">react</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">  indent:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">error</span></span><br><span class="line"><span class="bullet">    -</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  linebreak-style:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">error</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">windows</span></span><br><span class="line"><span class="attr">  quotes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">error</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">single</span></span><br><span class="line"><span class="attr">  semi:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">error</span></span><br><span class="line"><span class="attr">  comma-dangle:</span> <span class="string">off</span></span><br><span class="line"><span class="attr">  no-unused-vars:</span> <span class="string">warn</span></span><br><span class="line"><span class="attr">  no-console:</span> <span class="string">error</span></span><br><span class="line"><span class="attr">  no-unexpected-multiline:</span> <span class="string">warn</span></span><br><span class="line">  <span class="string">import/prefer-default-export:</span> <span class="string">off</span></span><br><span class="line"><span class="attr">settings:</span></span><br><span class="line"><span class="attr">  react:</span></span><br><span class="line"><span class="attr">    pragma:</span> <span class="string">React</span></span><br><span class="line"><span class="attr">    version:</span> <span class="string">detect</span></span><br></pre></td></tr></table></figure>
<p>像VSCode，可以在首选项 -&gt; 设置 中找到eslint.validate，加入typescript与typescriptreact，分别用于监听ts与tsx文件，如下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"eslint.validate": [</span><br><span class="line">    "javascript",</span><br><span class="line">    "javascriptreact",</span><br><span class="line">    "typescript",</span><br><span class="line">    <span class="string">"typescriptreact"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>更多配置可以自己定制。</p>
<h2><span id="storybook">Storybook</span></h2>
<p>storybook的主要作用是为自己实现的组件编写文档，可以在<a href="https://storybook.js.org/" target="_blank" rel="noopener">这里</a>查看更多细节。</p>
<p>安装storybook：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev @storybook/react</span><br></pre></td></tr></table></figure>
<p>加入package.json的script</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"storybook"</span>: <span class="string">"start-storybook -p 9001 -c .storybook"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认storybook会在.storybook文件夹作为配置，配置文件为config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .storybook/config.js中修改路径</span></span><br><span class="line"><span class="keyword">import</span> &#123; configure &#125; <span class="keyword">from</span> <span class="string">'@storybook/react'</span>;</span><br><span class="line"><span class="comment">// src/stories/button.stories.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = <span class="built_in">require</span>.context(<span class="string">'../src/stories'</span>, <span class="literal">true</span>, /\.stories\.js$/);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadStories</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  req.keys().forEach(<span class="function">(<span class="params">filename</span>) =&gt;</span> req(filename));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configure(loadStories, <span class="built_in">module</span>);</span><br></pre></td></tr></table></figure>
<p>上面配置指定了创建stories的位置，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// .storybook/config.js中修改路径</span><br><span class="line">import &#123; configure &#125; from &apos;@storybook/react&apos;;</span><br><span class="line"></span><br><span class="line">function loadStories() &#123;</span><br><span class="line">  require(&apos;../src/stories/button.stories.js&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configure(loadStories, module);</span><br><span class="line"></span><br><span class="line">// src/stories/button.stories.js</span><br><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123; storiesOf &#125; from &apos;@storybook/react&apos;;</span><br><span class="line">import &#123;Button&#125; from &apos;../components/Button&apos;;</span><br><span class="line"></span><br><span class="line">storiesOf(&apos;Button&apos;, module)</span><br><span class="line">  .add(&apos;基本用法&apos;,() =&gt; (</span><br><span class="line">    &lt;Button&gt;按钮&lt;/Button&gt;</span><br><span class="line">  ))</span><br><span class="line">  </span><br><span class="line">// src/components/Button.js</span><br><span class="line">import React from &apos;react&apos;</span><br><span class="line"></span><br><span class="line">export class Button extends React.Component&#123;</span><br><span class="line">  constructor (props) &#123;</span><br><span class="line">    super(props)    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;button style=&#123;&#123;backgroundColor: &apos;#fff&apos;, border: &apos;1px solid #ccc&apos;&#125;&#125;&gt;&#123;this.props.children&#125;&lt;/button&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动stroybook服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn storybook</span><br></pre></td></tr></table></figure>
<p><img src="/img/react/storybook-script.png" alt="storybook"></p>
<p>默认会自动打开浏览器</p>
<p><img src="/img/react/storybook.png" alt="storybook"></p>
<p>出现以上页面说明配置已经成功了。</p>
<h2><span id="live-editing">Live Editing</span></h2>
<p>默认地，webpack的development mode在每次更新代码时，会自动刷新页面。但刷新不同于Live Edit，我不希望编写一个CSS还要重新refresh一下，页面直接变化就最好了！有很多工具可以实现这种方式，这里仅介绍react-hot-loader：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev react-hot-loader</span><br></pre></td></tr></table></figure>
<p>在script里面加入一个<code>--hot</code>选项即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">	<span class="string">"start"</span>: <span class="string">"./node_modules/.bin/webpack-dev-server --hot --mode development --progress --colors --config ./webpack.config.js"</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>出现以下效果，说明Live Editing功能实现了。</p>
<video src="/img/react/react-hot-loader.mp4" type="video/mp4" controls="controls" width="100%" height="100%">
</video>
<h2><span id="summary">Summary</span></h2>
<p>由于使用的东西比较多，而且开发的方式也比较灵活，具体技术细节可以具体深入理解。</p>
<p>完整代码，可以参考我的<a href="https://github.com/barudisshu/galilei-ui" target="_blank" rel="noopener">github</a></p>
</div></article><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2019/01/16/react/react-storybook-live-editing/';
var disqus_title = '使用storybook开发自己的React组件库';
var disqus_url = 'http://galudisu.info/2019/01/16/react/react-storybook-live-editing/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//barudisshu-github-io.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>©2016 - 2020 <a href="http://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready"><script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css"><script src="/js/base.js"></script><script src="/js/rabbit-lyrics.js"></script></div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end --></body></html>