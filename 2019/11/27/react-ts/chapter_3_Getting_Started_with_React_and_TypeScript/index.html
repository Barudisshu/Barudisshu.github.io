<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>Learning React with Typescript3 - chapter 3 开始在React中使用TS</title><link rel="stylesheet" href="/css/layout.css">
<!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css"><link rel="shortcut icon" href="/img/favicon.ico"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">简单易懂の现代魔法</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="http://weibo.com/u/2360401155" class="menu-link">Weibo</a></li><li class="menu-item"><a href="/about" class="menu-link">About</a></li><li class="menu-item"><a href="/atom.xml" class="menu-link">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">简单易懂の现代魔法</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="http://weibo.com/u/2360401155" class="menu-link">Weibo</a></li><li class="menu-item"><a href="/about" class="menu-link">About</a></li><li class="menu-item"><a href="/atom.xml" class="menu-link">Rss</a></li></ul></nav><div id="mobile-menu-toggle" class="toggle-menu"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">Learning React with Typescript3 - chapter 3 开始在React中使用TS</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2019-11-27</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tags"> </i><a href="/tags/react/" class="tag-link">react<span class="tag">, </span></a><a href="/tags/typescript/" class="tag-link">typescript</a></p><p class="meta-item meta-category"><span class="meta-item-title"></span><i class="icon-bookmark"> </i><a href="/categories/react/" class="category-link">react</a></p></div><div class="article-content"><ul>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><li>创建一个React和TypeScript项目</li>
<li>创建一个类组件</li>
<li>处理类组件的事件</li>
<li>类组件的状态</li>
<li>类组件声明周期方法</li>
<li>创建一个函数组件</li>
</ul>
<h2><span id="创建一个react和typescript项目">创建一个React和TypeScript项目</span></h2>
<h3><span id="使用create-react-app">使用<code>create-react-app</code></span></h3>
<p><code>create-eract-app</code>是一个npm包的命令行工具，用于快速创建React和TypeScript应用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app my-react-ts-app --typescript</span><br></pre></td></tr></table></figure>
<p>项目创建后，添加TSLint，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> my-react-ts-app</span><br><span class="line">npm install tslint tslint-react tslint-config-prettier --save-dev</span><br></pre></td></tr></table></figure>
<p>添加文件<code>tslint.json</code>，包含一些规则，</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"extends"</span>: [<span class="string">"tslint:recommended"</span>, <span class="string">"tslint-react"</span>, <span class="string">"tslintconfig-prettier"</span>],</span><br><span class="line">	<span class="attr">"rules"</span>: &#123;</span><br><span class="line">		<span class="attr">"ordered-imports"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"object-literal-sort-keys"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"no-debugger"</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">"no-console"</span>: <span class="literal">false</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"linterOptions"</span>: &#123;</span><br><span class="line">		<span class="attr">"exclude"</span>: [</span><br><span class="line">			<span class="string">"config/**/*.js"</span>,</span><br><span class="line">			<span class="string">"node_modules/**/*.ts"</span>,</span><br><span class="line">			<span class="string">"coverage/lcov-report/*.js"</span></span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>
<h3><span id="创建一个简单的react-component">创建一个简单的React component</span></h3>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: React.SFC = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &lt;h1&gt; My React App!&lt;<span class="regexp">/h1&gt;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p><code>React.SFC</code>是一个TypeScript的React类型，它不包含任何内部状态。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">const</span> App: React.SFC = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> &lt;h1&gt;My React App!&lt;<span class="regexp">/h1&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>) <span class="keyword">as</span> HTMLElement);</span><br></pre></td></tr></table></figure>
<h3><span id="添加webpack">添加webpack</span></h3>
<p>(略)</p>
<h3><span id="项目目录结构">项目目录结构</span></h3>
<p>(略)</p>
<h3><span id="创建一个基本的类组件">创建一个基本的类组件</span></h3>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Confirm <span class="keyword">extends</span> React.Component &#123;</span><br><span class="line">	<span class="keyword">public</span> render() &#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Confirm;</span><br></pre></td></tr></table></figure>
<p><code>render</code>方法决定了该组件需要展示的内容。我们用JSX来定义需要展示的内容。简单来说，JSX就是HTML和JavaScript的混合。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public render() &#123;</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		&lt;div className=<span class="string">"confirm-wrapper confirm-visible"</span>&gt;</span><br><span class="line">			&lt;div className=<span class="string">"confirm-container"</span>&gt;</span><br><span class="line">				&lt;div className=<span class="string">"confirm-title-container"</span>&gt;</span><br><span class="line">					&lt;span&gt;This is where our title should go&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">				&lt;/</span>div&gt;</span><br><span class="line">			&lt;div className=<span class="string">"confirm-content-container"</span>&gt;</span><br><span class="line">				&lt;p&gt;This is where our content should go&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">			&lt;/</span>div&gt;</span><br><span class="line">			&lt;div className=<span class="string">"confirm-buttons-container"</span>&gt;</span><br><span class="line">				&lt;button className=<span class="string">"confirm-cancel"</span>&gt;Cancel&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">				&lt;button className="confirm-ok"&gt;Okay&lt;/</span>button&gt;</span><br><span class="line">			&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">		&lt;/</span>div&gt;</span><br><span class="line">	&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>怎么使用<code>Confirm</code>组件？在<code>App.tsx</code>中，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import Confirm from &apos;./Confirm&apos;;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&lt;div className=&quot;App&quot;&gt;</span><br><span class="line">	&lt;header className=&quot;App-header&quot;&gt;</span><br><span class="line">		...</span><br><span class="line">	&lt;/header&gt;</span><br><span class="line">	&lt;Confirm /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="jsx">JSX</span></h2>
<p>JSX看起来很像HTML，它不是有效的JavaScript，我们需要一个处理步骤将其转换为JavaScript。</p>
<p>打开浏览器，进入<a href="https://babeljs.io/repl" target="_blank" rel="noopener">https://babeljs.io/repl</a>，输入下面内容，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>This is where our title should go<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>右侧会获得编译之后的JS文件，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(</span><br><span class="line">	<span class="string">"span"</span>,</span><br><span class="line">	<span class="literal">null</span>,</span><br><span class="line">	<span class="string">"This is where our title should go"</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><code>React.createElement</code>有三个参数，</p>
<ul>
<li>元素类型，可以是一个HTML标签，一个React组件类型，或一个React 代码段</li>
<li>属性对象</li>
<li>子类或内容</li>
</ul>
<p>例如，</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">"confirm-title-container"</span>&gt;</span><br><span class="line">	&lt;span&gt;This is where our title should go&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>
<p>最终会被编译为，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(</span><br><span class="line">	<span class="string">"div"</span>,</span><br><span class="line">	&#123; <span class="attr">className</span>: <span class="string">"confirm-title-container"</span> &#125;,</span><br><span class="line">	React.createElement(</span><br><span class="line">		<span class="string">"span"</span>,</span><br><span class="line">		<span class="literal">null</span>,</span><br><span class="line">		<span class="string">"This is where our title should go"</span></span><br><span class="line">	)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>现在看是有意义的，但目前仅由HTML构筑。加点JavaScript代码看看，</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = &#123;</span><br><span class="line">	title: <span class="string">"React and TypeScript"</span></span><br><span class="line">&#125;;</span><br><span class="line">&lt;div className=<span class="string">"confirm-title-container"</span>&gt;</span><br><span class="line">	&lt;span&gt;&#123;props.title&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>
<p>它会被编译为，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> props = &#123;</span><br><span class="line">	title: <span class="string">"React and TypeScript"</span></span><br><span class="line">&#125;;</span><br><span class="line">React.createElement(</span><br><span class="line">	<span class="string">"div"</span>,</span><br><span class="line">	&#123; <span class="attr">className</span>: <span class="string">"confirm-title-container"</span> &#125;,</span><br><span class="line">	React.createElement(</span><br><span class="line">		<span class="string">"span"</span>,</span><br><span class="line">		<span class="literal">null</span>,</span><br><span class="line">		props.title</span><br><span class="line">	)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>更进一步，让字面量<code>props</code>为空，</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = &#123;&#125;;</span><br><span class="line">&lt;div className=<span class="string">"confirm-title-container"</span>&gt;</span><br><span class="line">	&lt;span&gt;&#123;props.title ? props.title : <span class="string">"React and TypeScript"</span>&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>
<p>内嵌调用原封不变，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(</span><br><span class="line">	<span class="string">"span"</span>,</span><br><span class="line">	<span class="literal">null</span>,</span><br><span class="line">	props.title ? props.title : <span class="string">"React and TypeScript"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>因此，为什么我们使用<code>className</code>属性而不是<code>class</code>？现在知道JSX会编译为JavaScript，由于<code>class</code>是JavaScript的关键字，在JSX包含<code>class</code>属性会发生冲突。因此React使用<code>className</code>代替CSS引用。</p>
</blockquote>
<h2><span id="component-props">Component props</span></h2>
<p>目前，组件<code>Confirm</code>的标题和内容是硬编码的。需要将这些引用属性以组件形式接收</p>
<ol>
<li>首先，我们需要为我们的props定义个TypeScript类型。我们将会用到一个接口，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface IProps &#123;</span><br><span class="line">	title: string;</span><br><span class="line">	content: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>将该<code>IProps</code>类型以尖括号引入定义中，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class Confirm extends React.Component&lt;IProps&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>React.Component</code>被称为泛型类。泛型类允许类型允许在内部传递使用。在我们的例子中，我们传递了<code>IProps</code>接口。</p>
</blockquote>
<ol start="3">
<li>然后我们的类内使用<code>this.props.propName</code>。在我们的JSX文件中，可以直接引用这些属性，取代硬编码的方式：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;div className=&quot;confirm-title-container&quot;&gt;</span><br><span class="line">	&lt;span&gt;&#123;this.props.title&#125;&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div className=&quot;confirm-content-container&quot;&gt;</span><br><span class="line">	&lt;p&gt;&#123;this.props.content&#125;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>目前编译不过，因为<code>Confirm</code>组件现在要求传入<code>title</code>和<code>content</code>属性，</p>
<p>修改为，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Confirm</span><br><span class="line">	title=&quot;React and TypeScript&quot;</span><br><span class="line">	content=&quot;Are you sure you want to learn React and TypeScript?&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<h3><span id="optional-props">Optional props</span></h3>
<p>接口Props的内容可以定义为可选属性，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface IProps &#123;</span><br><span class="line">	title: string;</span><br><span class="line">	content: string;</span><br><span class="line">	cancelCaption?: string;</span><br><span class="line">	okCaption?: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="default-prop-values">Default prop values</span></h3>
<blockquote>
<p>当组件被初始化，可以被组件添加默认props属性值。它通过一个称为<code>defaultProps</code>的静态对象字面量实现。</p>
</blockquote>
<ol>
<li>创建默认的<code>cancelCaption</code>和<code>okCaption</code>，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class Confirm extends React.Component&lt;IProps&gt; &#123;</span><br><span class="line">	public static defaultProps = &#123;</span><br><span class="line">		cancelCaption: &quot;Cancel&quot;,</span><br><span class="line">		okCaption: &quot;Okay&quot;</span><br><span class="line">	&#125;;</span><br><span class="line">	public render() &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要覆盖默认属性，补充具体属性值即可，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Confirm</span><br><span class="line">	title=&quot;React and TypeScript&quot;</span><br><span class="line">	content=&quot;Are you sure you want to learn React and TypeScript?&quot;</span><br><span class="line">	cancelCaption=&quot;No way&quot;</span><br><span class="line">	okCaption=&quot;Yes please!&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>带有默认值的可选属性便于组件使用，这样大部分通用的配置可以自动装配起来，不用组个指定。</p>
</blockquote>
<h2><span id="处理类组件事件">处理类组件事件</span></h2>
<p>事件存在于多数编程语言中。以允许我们执行特定逻辑。</p>
<h3><span id="基础事件句柄">基础事件句柄</span></h3>
<blockquote>
<p>所有的本地JavaScript事件都可以在JSX中处理。JSX允许我们通过属性来调用这些事件函数。本地事件名会被带上前缀<code>on</code>以峰驼方式传递。因此，例如在JS中的属性事件是<code>click</code>，在JSX则对应<code>onClick</code>。</p>
</blockquote>
<p><strong>要查看所有可用事件列表，可以前往<code>node_modules/@types/react</code>文件夹的<code>index.d.ts</code>文件</strong></p>
<ol>
<li>首先是我们需要处理按钮上的<code>click</code>事件，对应上为，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button className=&quot;confirm-ok&quot; onClick=&#123;this.handleOkClick&#125;&gt;...&lt;/button&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>创建这个<code>handleOkClick</code>方法，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private handleOkClick() &#123;</span><br><span class="line">	console.log(&quot;Ok clicked&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="the-this-problem">The this problem</span></h3>
<p>在事件的处理上承受来自JavaScript的经典<code>this</code>问题。我们在事件处理上获取不到引用，譬如，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private handleOkClick() &#123;</span><br><span class="line">	console.log(&quot;Ok clicked&quot;, this.props):</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点击按钮，会出现undefined！！原因是<code>this</code>代表的是当前这个事件，而不是我们的类！</p>
<p>一种解决方法是，将<code>handleOkClick</code>方法改为 arrow function。</p>
<blockquote>
<p>arrow function相当于一个表达式。它不会创建自身的<code>this</code>——这样解决了<code>this</code>的问题。</p>
</blockquote>
<p>我们把原来的方法改一改，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private handleOkClick = () =&gt; &#123;</span><br><span class="line">	console.log(&quot;Ok clicked&quot;, this.props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在再次点击按钮，程序正常了。</p>
<h3><span id="function-props">Function props</span></h3>
<p>有时候需要在组件消费者(component)中传递事件处理逻辑。</p>
<ol>
<li>修改对应的IProps接口，对应函数类型属性，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface IProps &#123;</span><br><span class="line">	title: string;</span><br><span class="line">	content: string;</span><br><span class="line">	cancelCaption?: string;</span><br><span class="line">	okCaption?: string;</span><br><span class="line">	onOkClick: () =&gt; void;</span><br><span class="line">	onCancelClick: () =&gt; void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在消费方引用函数属性，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Confirm</span><br><span class="line">	...</span><br><span class="line">	onCancelClick=&#123;this.handleCancelConfirmClick&#125;</span><br><span class="line">	onOkClick=&#123;this.handleOkConfirmClick&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<h3><span id="类组件状态">类组件状态</span></h3>
<p>状态是一个对象，它决定了组件的行为和渲染。我们需要在我们的app中引入状态，以管理我们Confirm窗口打开或关闭。</p>
<p>State的定义和Props类型，首先我们需要创建一个接口，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface IState &#123;</span><br><span class="line">	confirmOpen: boolean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着传递<code>React.Component</code>的第二个泛型参数中，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class App extends React.Component&lt;&#123;&#125;, IState&gt;</span><br></pre></td></tr></table></figure>
<h3><span id="initializing-the-state">Initializing the state</span></h3>
<p>定义的状态需要被初始化，初始化动作在构造函数中实现，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">constructor(props: &#123;&#125;) &#123;</span><br><span class="line">	super(props);</span><br><span class="line">	this.state = &#123;</span><br><span class="line">		confirmOpen: true,</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>state被存放在组件类内的一个私有属性中。以及可以在组件内被使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Confirm</span><br><span class="line">	open=&#123;this.state.confirmOPen&#125;</span><br><span class="line">	...</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<h3><span id="changing-state">Changing state</span></h3>
<p>状态的改变不能直接访问控制，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private handleOkConfirmClick = () =&gt; &#123;</span><br><span class="line">	this.state.confirmOpen = false;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>它会出现错误消息说状态是read-only!的。我们需要使用<code>setState</code>方法来改变状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private handleOkConfirmClick = () =&gt; &#123;</span><br><span class="line">	this.setState(&#123; confirmOpen: false &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们仅能在构造函数中初始化State，其它类组件任何地方都不能初始化状态。以及，状态的更改，仅能在改组件内调用<code>setState</code>实现。</p>
<h2><span id="class-component-life-cycle-methods">Class component life cycle methods</span></h2>
<p>生命周期允许我们在特定点做某些处理。</p>
<h3><span id="componentdidmount">componentDidMount</span></h3>
<p>当一个组件被插入到DOM中时，<code>componentDidMount</code>被调用。下面是一些该方法常见的用例：</p>
<ul>
<li>调用web service以获取某些数据</li>
<li>添加事件监听</li>
<li>初始化计时</li>
<li>初始化第三方库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private timer: number = 0;</span><br><span class="line"></span><br><span class="line">public componentDidMount() &#123;</span><br><span class="line">	this.timer = window.setInterval(() =&gt; this.handleTimerTick(), 1000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="componentwillunmount">componentWillUnmount</span></h3>
<p>当组件从DOM内被移除时触发<code>componentWillUnmount</code>，下面是常见的用例，</p>
<ul>
<li>移除事件监听器</li>
<li>取消激活的网络请求</li>
<li>移除计时器</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public componentWillUnmount() &#123;</span><br><span class="line">	clearInterval(this.timer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="getderivedstatefromprops">getDerivedStateFromProps</span></h3>
<p>每次组件被渲染时，触发<code>getDerivedStateFromProps</code>。它是一个组件的静态方法，返回改变的状态或返回null。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static getDerivedStateFromProps(props: &#123;&#125;, state: IState) &#123;</span><br><span class="line">	console.log(&quot;getDerivedStateFromProps&quot;, props, state);</span><br><span class="line">	return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="getsnapshotbeforeupdate-and-componentdidupdate">getSnapshotBeforeUpdate and componentDidUpdate</span></h3>
<h3><span id="shouldcomponentupdate">shouldComponentUpdate</span></h3>
<h2><span id="creating-a-function-component">Creating a function component</span></h2>
<p>函数组件是从JavaScript函数实现的。</p>
<h3><span id="creating-a-basic-function-component">Creating a basic function component</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const Confirm: React.SFC&lt;IProps&gt; = (props) =&gt; &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完整示例如下，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const ComponentName: React.SFC&lt;IProps&gt; = props =&gt; &#123;</span><br><span class="line">	const handler = () =&gt; &#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;;</span><br><span class="line">	</span><br><span class="line">	return (</span><br><span class="line">		&lt;div&gt; Our JSX&lt;/div&gt;</span><br><span class="line">	);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ComponentName.defaultProps = &#123;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default ComponentName;</span><br></pre></td></tr></table></figure>
<h3><span id="stateful-function-components">Stateful function components</span></h3>
<p>富状态函数组件，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const Confirm: React.SFC&lt;IProps&gt; = props =&gt; &#123;</span><br><span class="line">	const [cancelClickCount, setCancelClickCount] = React.useState(0);</span><br><span class="line">	</span><br><span class="line">	const handleOkClick = () =&gt; &#123;</span><br><span class="line">		props.onOkClick();</span><br><span class="line">	&#125;;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2019/11/27/react-ts/chapter_3_Getting_Started_with_React_and_TypeScript/';
var disqus_title = 'Learning React with Typescript3 - chapter 3 开始在React中使用TS';
var disqus_url = 'http://galudisu.info/2019/11/27/react-ts/chapter_3_Getting_Started_with_React_and_TypeScript/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//barudisshu-github-io.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>©2016 - 2019 <a href="http://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready"><script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css"><script src="/js/base.js"></script><script src="/js/rabbit-lyrics.js"></script></div><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>