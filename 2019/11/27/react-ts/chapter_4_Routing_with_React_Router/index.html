<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>第四章 React Router</title>
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css">
<link rel="shortcut icon" href="/img/favicon.ico"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="简单易懂の现代魔法" type="application/atom+xml">
</head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a class="menu-link" href="/">简单易懂の现代魔法</a></li><li class="menu-item"><a class="menu-link" href="/archives/">Archives</a></li><li class="menu-item"><a class="menu-link" target="_blank" rel="noopener" href="http://weibo.com/u/2360401155">Weibo</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item"><a class="menu-link" href="/atom.xml">Rss</a></li></ul></nav><div class="toggle-menu" id="mobile-menu-toggle"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">第四章 React Router</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2019-11-27</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tags"> </i><a class="tag-link" href="/tags/react/">react<span class="tag">, </span></a><a class="tag-link" href="/tags/typescript/">typescript</a></p><p class="meta-item meta-category"><span class="meta-item-title"></span><i class="icon-bookmark"> </i><a class="category-link" href="/categories/react/">react</a></p></div><div class="article-content"><ul>
<li>安装React Router</li>
<li>声明路由</li>
<li>创建向导</li>
<li>路由参数</li>
<li>处理not found路由</li>
<li>实现页面重定向</li>
<li>查询参数</li>
<li>路由提示符</li>
<li>内嵌路由</li>
<li>动画转换</li>
<li>lazy loading 路由</li>
</ul>
<h2><span id="安装路由">安装路由</span></h2>
<p>将React Router添加进项目中，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-router-dom</span><br></pre></td></tr></table></figure>
<p>以及将TypeScript版本的React Router添加到devDependency的开发依赖中，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D @types/react-router-dom</span><br></pre></td></tr></table></figure>
<h2><span id="声明路由">声明路由</span></h2>
<p>在页面我们需要使用<code>BrowserRouter</code>和<code>Route</code>组件。<code>BrowserRouter</code>是top-level组件，会寻找下层的<code>Route</code>组件以决定不同的页面路径。</p>
<p>在引入<code>BrowserRouter</code>和<code>Route</code>之前，首先创建两个页面，</p>
<ol>
<li>创建一个<code>ProductsData.ts</code>文件，内容如下，</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IProduct &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">    description: <span class="built_in">string</span>;</span><br><span class="line">    price: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> products: IProduct[] = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&quot;A collection of navigational components that compose declaratively with your app&quot;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;React Router&quot;</span>,</span><br><span class="line">        <span class="attr">price</span>: <span class="number">8</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&quot;A library that helps manage state across your app&quot;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;React Redux&quot;</span>,</span><br><span class="line">        <span class="attr">price</span>: <span class="number">12</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&quot;A library that helps you interact with a GraphQL backend&quot;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;React Apollo&quot;</span>,</span><br><span class="line">        <span class="attr">price</span>: <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>创建另外一个<code>ProductsPage.tsx</code>文件导入这些数据，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import &#123; IProduct, products &#125; from &quot;./ProductsData&quot;;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>因为需要在组件引用数据，创建一个接口，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface IState &#123;</span><br><span class="line">	products: IProduct[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>创建类组件，初始化状态，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class ProductsPage extends React.Component&lt;&#123;&#125;, IState&gt; &#123;</span><br><span class="line">    public constructor(props: &#123;&#125;) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            products: []</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default ProductsPage;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>实现<code>componentDidMount</code>生命周期方法，更新组件的State，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public componentDidMount() &#123;</span><br><span class="line">	this.setState(&#123; products &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>实现对应的<code>render</code>方法进行渲染，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public render() &#123;</span><br><span class="line">	return (</span><br><span class="line">		&lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">			&lt;p&gt;Welcome to React Shop where you can get all your tools for ReactJS!&lt;/p&gt;</span><br><span class="line">			&lt;ul className=&quot;product-list&quot;&gt;</span><br><span class="line">				&#123;this.state.products.map(product =&gt; (</span><br><span class="line">					&lt;li key=&#123;product.id&#125; className=&quot;product-list-item&quot;&gt;</span><br><span class="line">						&#123;product.name&#125;</span><br><span class="line">					&lt;/li&gt;</span><br><span class="line">				))&#125;</span><br><span class="line">			&lt;/ul&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>对应CSS样式为，</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.page-container</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: large;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.product-list</span> &#123;</span><br><span class="line">  <span class="attribute">list-style</span>: none;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.product-list-item</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="8">
<li>实现第二个页面，文件名为<code>AdminPage.tsx</code>，它是个无状态组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const AdminPage: React.SFC = () =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">            &lt;h1&gt;Admin Panel&lt;/h1&gt;</span><br><span class="line">            &lt;p&gt;You should only be here if you have logged in&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default AdminPage;</span><br></pre></td></tr></table></figure>
<ol start="9">
<li>现在我们有两个页面了，需要为其定义两个路由。首先创建一个<code>Routes.tsx</code>的文件，包含下面的内容，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import &#123; BrowserRouter as Router, Route &#125; from &quot;react-router-dom&quot;;</span><br><span class="line">import AdminPage from &quot;./AdminPage&quot;;</span><br><span class="line">import ProductsPage from &quot;./ProductsPage&quot;;</span><br></pre></td></tr></table></figure>
<ol start="10">
<li>渲染路由页面，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const Routes: React.SFC = () =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;Router&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;Route path=&quot;/products&quot; component=&#123;ProductsPage&#125; /&gt;</span><br><span class="line">                &lt;Route path=&quot;/admin&quot; component=&#123;AdminPage&#125; /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/Router&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Routes;</span><br></pre></td></tr></table></figure>
<ol start="11">
<li>最后一步，把<code>Routes</code>添加到根组件<code>index.tsx</code>中，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import ReactDOM from &#x27;react-dom&#x27;;</span><br><span class="line">import &#x27;./index.css&#x27;;</span><br><span class="line">import Routes from &quot;./Routes&quot;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;Routes /&gt;, </span><br><span class="line">    document.getElementById(&#x27;root&#x27;) as HTMLElement);</span><br></pre></td></tr></table></figure>
<ol start="12">
<li>目前页面上是什么也没有看到的，需要我们在浏览器直接输入地址，“<code>/products</code>”，或者访问另一个页面&quot;<code>/admin</code>&quot;,</li>
</ol>
<h2><span id="创建路由向导">创建路由向导</span></h2>
<p>非常幸运的是，React Router有一些组件提供了向导的功能。</p>
<h3><span id="using-the-link-component">Using the Link component</span></h3>
<p>使用<code>Link</code>组件实现向导功能，</p>
<ol>
<li>创建一个<code>Header.tsx</code>文件，包含以下内容，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import &#123; Link &#125; from &quot;react-router-dom&quot;;</span><br><span class="line"></span><br><span class="line">import logo from &quot;./logo.svg&quot;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>接着创建两个<code>Link</code>链接，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const Header: React.SFC = () =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;header className=&quot;header&quot;&gt;</span><br><span class="line">            &lt;img src=&#123;logo&#125; className=&quot;header-logo&quot; alt=&quot;logo&quot; /&gt;</span><br><span class="line">            &lt;h1 className=&quot;header-title&quot;&gt;React Shop&lt;/h1&gt;</span><br><span class="line">            &lt;nav&gt;</span><br><span class="line">                &lt;Link to=&quot;/products&quot; className=&quot;header-link&quot;&gt;Products&lt;/Link&gt;</span><br><span class="line">                &lt;Link to=&quot;/admin&quot; className=&quot;header-link&quot;&gt;Admin&lt;/Link&gt;</span><br><span class="line">            &lt;/nav&gt;</span><br><span class="line">        &lt;/header&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Header;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>添加对应的CSS样式，</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#222</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">160px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header-logo</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: header-logo-spin infinite <span class="number">20s</span> linear;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> header-logo-spin &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header-title</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.5em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header-link</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>把<code>Header</code>添加到我们的<code>Routes.tsx</code>，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import Header from &quot;./Header&quot;;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>加入导航，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Router&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;Header /&gt;</span><br><span class="line">		&lt;Route path=&quot;/products&quot; component=&#123;ProductsPage&#125; /&gt;</span><br><span class="line">		&lt;Route path=&quot;/admin&quot; component=&#123;AdminPage&#125; /&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/Router&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="使用navlink组件">使用NavLink组件</span></h2>
<p>React Router还提供了另外一个组件用于页面链接，称为<code>NavLink</code>。下面我们用<code>NavLink</code>重构一下原来的<code>Header</code>组件，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import &#123; NavLink &#125; from &quot;react-router-dom&quot;;</span><br><span class="line"></span><br><span class="line">import logo from &quot;./logo.svg&quot;;</span><br><span class="line"></span><br><span class="line">const Header: React.SFC = () =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;header className=&quot;header&quot;&gt;</span><br><span class="line">            &lt;img src=&#123;logo&#125; className=&quot;header-logo&quot; alt=&quot;logo&quot; /&gt;</span><br><span class="line">            &lt;h1 className=&quot;header-title&quot;&gt;React Shop&lt;/h1&gt;</span><br><span class="line">            &lt;nav&gt;</span><br><span class="line">                &lt;NavLink to=&quot;/products&quot; className=&quot;header-link&quot;&gt;Products&lt;/NavLink&gt;</span><br><span class="line">                &lt;NavLink to=&quot;/admin&quot; className=&quot;header-link&quot;&gt;Admin&lt;/NavLink&gt;</span><br><span class="line">            &lt;/nav&gt;</span><br><span class="line">        &lt;/header&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Header;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><code>NavLink</code>暴露了一个<code>activeClassName</code>属性</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;NavLink to=&quot;/products&quot; className=&quot;header-link&quot; activeClassName=&quot;header-link-active&quot;&gt;Products&lt;/NavLink&gt;</span><br><span class="line">&lt;NavLink to=&quot;/admin&quot; className=&quot;header-link&quot; activeClassName=&quot;header-link-active&quot;&gt;Admin&lt;/NavLink&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>添加对应CSS样式，</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-class">.header-link-active</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">#ebebeb</span> solid <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此，<code>NavLink</code>主要让我们导航带上样式功能。</p>
<h3><span id="路由参数">路由参数</span></h3>
<p>路由参数是路径变量的部分，用于决定目标组件的渲染逻辑。</p>
<p>我们需要添加另外一个页面，来展示商品的描述内容和价格，我们想要让页面导向使用&quot;<code>/products/&#123;id&#125;</code>&quot;路径，其中<code>id</code>对应商品ID。</p>
<ol>
<li>首先在原来的<code>Routes.tsx</code>添加路由路径和参数，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=&quot;/products&quot; component=&#123;ProductsPage&#125; /&gt;</span><br><span class="line">&lt;Route path=&quot;/products/:id&quot; component=&#123;ProductPage&#125; /&gt;</span><br><span class="line">&lt;Route path=&quot;/admin&quot; component=&#123;AdminPage&#125; /&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>创建对应的<code>ProductPage</code>组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import &#123; RouteComponentProps &#125; from &quot;react-router-dom&quot;;</span><br><span class="line">import &#123; IProduct, products &#125; from &quot;./ProductsData&quot;;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>这里的关键点是，我们需要用到<code>RouteComponentProps</code>来访问路径上的参数<code>id</code>。另外需要定义类型别名</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type Props = RouteComponentProps&lt;&#123;id: string&#125;&gt;;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>另外还需要有个状态记录商品被添加到购物篮中，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface IState &#123;</span><br><span class="line">    product?: IProduct;</span><br><span class="line">    added: boolean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>初始化该状态，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class ProductPage extends React.Component&lt;Props, IState&gt; &#123;</span><br><span class="line">    public constructor(props: Props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.setState(&#123; added: false &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default ProductPage;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>当组件被加载进DOM，会通过路径参数上的id查找商品。<code>RouteComponentProps</code>给我们提供了一个<code>match</code>对象，以访问路径上的参数，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public componentDidMount() &#123;</span><br><span class="line">        if (this.props.match.params.id) &#123;</span><br><span class="line">          const id: number = parseInt(this.props.match.params.id, 10);</span><br><span class="line">          const product = products.filter(p =&gt; p.id === id)[0];</span><br><span class="line">          this.setState(&#123; product &#125;);  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>记住，路径参数id是个字符串，需要使用<code>parseInt</code>进行转换，</p>
<ol start="7">
<li>初始化好商品和组件状态后，我们进入到<code>render</code>函数，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public render() &#123;</span><br><span class="line">const product = this.state.product;</span><br><span class="line">return (</span><br><span class="line">  &lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">	&#123;product ? (</span><br><span class="line">	  &lt;React.Fragment&gt;</span><br><span class="line">		&lt;h1&gt;&#123;product.name&#125;&lt;/h1&gt;</span><br><span class="line">		&lt;p&gt;&#123;product.description&#125;&lt;/p&gt;</span><br><span class="line">		&lt;p className=&quot;product-price&quot;&gt;</span><br><span class="line">			&#123;new Intl.NumberFormat(&quot;en-US&quot;, &#123;</span><br><span class="line">				currency: &quot;USD&quot;,</span><br><span class="line">				style: &quot;currency&quot;</span><br><span class="line">			&#125;).format(product.price)&#125;</span><br><span class="line">		&lt;/p&gt;</span><br><span class="line">		&#123;!this.state.added &amp;&amp; (</span><br><span class="line">			&lt;button onClick=&#123;this.handleAddClick&#125;&gt;Add to basket&lt;/button&gt;</span><br><span class="line">		)&#125;</span><br><span class="line">	  &lt;/React.Fragment&gt;</span><br><span class="line">	) : (</span><br><span class="line">	  &lt;p&gt;Product not found!&lt;/p&gt;</span><br><span class="line">	)&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里有一些新东西，</p>
<ul>
<li>第一行创建了常量<code>product</code>；</li>
<li>三元运算符</li>
<li>使用了<code>React.Fragment</code>，类似实现单独一个parent的功能</li>
<li>使用了<code>Intl.NumberFormat</code>装换货币符号</li>
</ul>
<ol start="8">
<li>另外还需要添加<code>handleAddClick</code>方法处理按钮事件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private handleAddClick = () =&gt; &#123;</span><br><span class="line">	this.setState(&#123; added: true &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="9">
<li>现在，将我们实现好的<code>ProductPage</code>组件，导入到<code>Routes.tsx</code>中，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import ProductPage from &quot;./ProductPage&quot;;</span><br></pre></td></tr></table></figure>
<ol start="10">
<li>
<p>直接浏览器键入&quot;<code>/products/2</code>&quot;查看新路由页面，但有个问题是&quot;<code>/products</code>&quot;和&quot;<code>/products/:id</code>&quot;都被渲染了</p>
</li>
<li>
<p>为了解决这个问题，修改为，</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route exact=&#123;true&#125; path=&quot;/products&quot; component=&#123;ProductsPage&#125; /&gt;</span><br></pre></td></tr></table></figure>
<ol start="12">
<li>进一步，我们需要为每个条目添加链接，回到原来的<code>ProductsPage.tsx</code>组件，修改相应部分内容，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Link &#125; from &quot;react-router-dom&quot;;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">public render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">          Welcome to React Shop where you can get all your tools for ReactJS!</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;ul className=&quot;product-list&quot;&gt;</span><br><span class="line">          &#123;this.state.products.map(product =&gt; (</span><br><span class="line">            &lt;li key=&#123;product.id&#125; className=&quot;product-list-item&quot;&gt;</span><br><span class="line">              &lt;Link to=&#123;`/products/$&#123;product.id&#125;`&#125;&gt;&#123;product.name&#125;&lt;/Link&gt;</span><br><span class="line">              &#123;product.name&#125;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          ))&#125;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="13">
<li>补充CSS样式，</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.product-list-item</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="handling-not-found-routes">Handling not found routes</span></h3>
<p>如果用户输入的路径不存在怎么处理？例如，我们尝试键入&quot;/tools&quot;，但路由中没有找到任何匹配的路由，我们希望提示该路径不存在。</p>
<ol>
<li>首先创建一个新的文件<code>NotFoundPage.tsx</code>，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const NotFoundPage: React.SFC = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">      &lt;h1&gt;Sorry, this page cannot be found&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default NotFoundPage;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在路由组件中，导入，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import NotFoundPage from &quot;./NotFoundPage&quot;;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>添加到路由，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Router&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">	&lt;Header /&gt;</span><br><span class="line">	&lt;Route exact=&#123;true&#125; path=&quot;/products&quot; component=&#123;ProductsPage&#125; /&gt;</span><br><span class="line">	&lt;Route path=&quot;/products/:id&quot; component=&#123;ProductPage&#125; /&gt;</span><br><span class="line">	&lt;Route path=&quot;/admin&quot; component=&#123;AdminPage&#125; /&gt;</span><br><span class="line">	&lt;Route component=&#123;NotFoundPage&#125; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/Router&gt;</span><br></pre></td></tr></table></figure>
<p>但其他页面也一同渲染了，我们希望如果没有找到对应路由页面，仅渲染<code>NotFoundPage</code>，这是需要用到<code>Switch</code>组件。</p>
<ol start="4">
<li>首先导入<code>Swith</code>组件到<code>Routes.tsx</code>中，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; BrowserRouter as Router, Route, Switch &#125; from &quot;react-router-dom&quot;;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>在<code>Route</code>包一层<code>Switch</code>组件即可，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Switch&gt;</span><br><span class="line">  &lt;Route exact=&#123;true&#125; path=&quot;/products&quot; component=&#123;ProductsPage&#125; /&gt;</span><br><span class="line">  &lt;Route path=&quot;/products/:id&quot; component=&#123;ProductPage&#125; /&gt;</span><br><span class="line">  &lt;Route path=&quot;/admin&quot; component=&#123;AdminPage&#125; /&gt;</span><br><span class="line">  &lt;Route component=&#123;NotFoundPage&#125; /&gt;</span><br><span class="line">&lt;/Switch&gt;</span><br></pre></td></tr></table></figure>
<p><code>Switch</code>组件仅渲染第一个匹配到的<code>Route</code>组件。在我们案例中，当找不到页面是，第一个匹配到的就是<code>NotFoundPage</code>，这样就解决了我们的问题。</p>
<h2><span id="实现页面重定向">实现页面重定向</span></h2>
<p>页面重定向使用了<code>Redirect</code>组件实现</p>
<h3><span id="simple-redirect">Simple redirect</span></h3>
<p>如果我们访问<code>/</code>路径，我们注意到它是个not found页面。我们希望当路径是<code>/</code>时，重定向到<code>/products</code>。</p>
<ol>
<li>首先，需要在<code>Routes.tsx</code>导入<code>Redirect</code>组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; BrowserRouter as Router, Redirect, Route, Switch &#125; from &quot;react-router-dom&quot;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>然后使用<code>Redirect</code>组件进行重定向，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Switch&gt;</span><br><span class="line">  &lt;Redirect exact=&#123;true&#125; from=&quot;/&quot; to=&quot;/products&quot; /&gt;</span><br><span class="line">  &lt;Route exact=&#123;true&#125; path=&quot;/products&quot; component=&#123;ProductsPage&#125; /&gt;</span><br><span class="line">  &lt;Route path=&quot;/products/:id&quot; component=&#123;ProductPage&#125; /&gt;</span><br><span class="line">  &lt;Route path=&quot;/admin&quot; component=&#123;AdminPage&#125; /&gt;</span><br><span class="line">  &lt;Route component=&#123;NotFoundPage&#125; /&gt;</span><br><span class="line">&lt;/Switch&gt;</span><br></pre></td></tr></table></figure>
<h3><span id="conditional-redirect">Conditional redirect</span></h3>
<p>另外我们可以用<code>Redirect</code>组件对为授权用户进行保护访问。例如，我们的shop例子中，我们仅确保登录用户可以访问我们的<code>Admin</code>页面。</p>
<ol>
<li>创建一个<code>LoginPage</code>路由，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=&quot;/login&quot; component=&#123;LoginPage&#125; /&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>添加一个登录页<code>LoginPage.tsx</code>组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const LoginPage: React.SFC = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">      &lt;h1&gt;Login&lt;/h1&gt;</span><br><span class="line">      &lt;p&gt;You need to login... &lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default LoginPage;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>回到原来的<code>Routes.tsx</code>导入<code>LoginPage</code>:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import LoginPage from &quot;./LoginPage&quot;;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>在重定向到&quot;<code>admin</code>&quot;之前，我们需要在<code>Routes.tsx</code>中添加一些状态值，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const Routes: React.SFC = () =&gt; &#123;</span><br><span class="line">	const [loggedIn, setLoggedIn] = React.useState(false);</span><br><span class="line">	return (</span><br><span class="line">	&lt;Router&gt;</span><br><span class="line">	...</span><br><span class="line">	&lt;/Router&gt;</span><br><span class="line">	);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>最后一步是添加条件判断，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=&quot;/admin&quot;&gt;</span><br><span class="line">&#123;loggedIn ? &lt;AdminPage /&gt; : &lt;Redirect to=&quot;/login&quot; /&gt;&#125;</span><br><span class="line">&lt;/Route&gt;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>如果我们将<code>loggedIn</code>状态修改为true，我们就可以再次访问我们的Admin页面了，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const [loggedIn, setLoggedIn] = React.useState(true);</span><br></pre></td></tr></table></figure>
<h2><span id="query-parameters">Query parameters</span></h2>
<p>查询参数是URL地址的一部分，例如&quot;<code>/products?search=redux</code>&quot;。让我们实现一个商品查询功能。</p>
<ol>
<li>在原来的<code>ProductsPage.tsx</code>中，添加一个状态变量<code>search</code>，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface IState &#123;</span><br><span class="line">  products: IProduct[];</span><br><span class="line">  search: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>我们需要用到<code>RouteComponentProps</code>作为属性，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; RouteComponentProps &#125; from &quot;react-router-dom&quot;;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>初始化</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class ProductsPage extends React.Component&lt;RouteComponentProps, IState&gt; &#123;</span><br><span class="line">  public constructor(props: RouteComponentProps) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      products: [],</span><br><span class="line">      search: &quot;&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>我们需要在<code>componentDidMount</code>确定好<code>search</code>的值，因此，实现<code>getDerivedStateFromProps</code>方法获取URL参数，并更新state，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public static getDerivedStateFromProps(</span><br><span class="line">    props: RouteComponentProps,</span><br><span class="line">    state: IState</span><br><span class="line">  ) &#123;</span><br><span class="line">    const searchParams = new URLSearchParams(props.location.search);</span><br><span class="line">    const search = searchParams.get(&quot;search&quot;) || &quot;&quot;;</span><br><span class="line">    return &#123;</span><br><span class="line">      products: state.products,</span><br><span class="line">      search</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>不幸的是，<code>URLsearchParams</code>没有在所有浏览器中实现，所以我们需要用到<code>url-search-params-polyfill</code>，</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D url-search-params-polyfill</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>导入到<code>ProductPages.tsx</code>中，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &quot;url-search-params-polyfill&quot;;</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>在渲染部分使用<code>search</code>状态，并包装一个<code>if</code>语句，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul className=&quot;product-list&quot;&gt;</span><br><span class="line">  &#123;this.state.products.map(product =&gt; &#123;</span><br><span class="line">	  if(</span><br><span class="line">		  !this.state.search || </span><br><span class="line">		  (this.state.search &amp;&amp;</span><br><span class="line">			product.name.toLowerCase().indexOf(this.state.search.toLowerCase()) &gt; -1)</span><br><span class="line">	  ) &#123;</span><br><span class="line">		  return (</span><br><span class="line">			&lt;li key=&#123;product.id&#125; className=&quot;product-list-item&quot;&gt;</span><br><span class="line">			  &lt;Link to=&#123;`/products/$&#123;product.id&#125;`&#125;&gt;&#123;product.name&#125;&lt;/Link&gt;</span><br><span class="line">			&lt;/li&gt;</span><br><span class="line">		  );</span><br><span class="line">	  &#125; else &#123;</span><br><span class="line">		  return null;</span><br><span class="line">	  &#125;</span><br><span class="line">  &#125;)&#125;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p>替换为搜索框搜索的方式… 我们需要，</p>
<ol start="8">
<li>在<code>Header.tsx</code>文件中创建state，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const [search, setSearch] = React.useState(&quot;&quot;);</span><br></pre></td></tr></table></figure>
<ol start="9">
<li>另外需要获取搜索参数，需要导入，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; NavLink, RouteComponentProps, withRouter&#125; from &quot;reactrouter-</span><br><span class="line">dom&quot;;</span><br><span class="line">import &quot;url-search-params-polyfill&quot;;</span><br></pre></td></tr></table></figure>
<ol start="10">
<li>添加<code>props</code>，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const Header: React.SFC&lt;RouteComponentProps&gt; = props =&gt; &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<ol start="11">
<li>组件首次渲染时，从路径参数获取值并设置<code>search</code>的状态，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const [search, setSearch] = React.useState(&quot;&quot;);</span><br><span class="line">React.useEffect(() =&gt; &#123;</span><br><span class="line">const searchParams = new</span><br><span class="line">URLSearchParams(props.location.search);</span><br><span class="line">setSearch(searchParams.get(&quot;search&quot;) || &quot;&quot;);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>
<ol start="12">
<li>将<code>search</code>添加到<code>redner</code>方法中，让用户进行输入，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">... </span><br><span class="line">&lt;header className=&quot;header&quot;&gt;</span><br><span class="line">	&lt;div className=&quot;search-container&quot;&gt;</span><br><span class="line">		&lt;input </span><br><span class="line">			type=&quot;search&quot;</span><br><span class="line">			placeholder=&quot;search&quot;</span><br><span class="line">			value=&#123;search&#125;</span><br><span class="line">			onChange=&#123;handleSearchChange&#125;</span><br><span class="line">			onKeyDown=&#123;handleSearchKeydown&#125;</span><br><span class="line">		/&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ol start="13">
<li>添加<code>search-container</code>CSS样式，</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.search-container</span> &#123;</span><br><span class="line"><span class="attribute">text-align</span>: right;</span><br><span class="line"><span class="attribute">margin-bottom</span>: -<span class="number">25px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="14">
<li>回到原来的<code>Header.tsx</code>，添加对应的事件处理方法，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const handleSearchChange = (e:</span><br><span class="line">React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; &#123;</span><br><span class="line">setSearch(e.currentTarget.value);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const handleSearchKeydown = (e:</span><br><span class="line">React.KeyboardEvent&lt;HTMLInputElement&gt;) =&gt; &#123;</span><br><span class="line">if (e.key === &quot;Enter&quot;) &#123;</span><br><span class="line">props.history.push(`/products?search=$&#123;search&#125;`);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="15">
<li>另外我们需要用<code>withRouter</code>包装<code>Header</code>暴露接口，以使<code>this.props.history</code>可以生效，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export default withRouter(Hader);</span><br></pre></td></tr></table></figure>
<h3><span id="route-prompts">Route prompts</span></h3>
<p><code>react-router-dom</code>组件中还有一个<code>Prompt</code>组件，顾名思义就是弹出框…</p>
<ol>
<li>我们希望用户离开商品页面时，如果没有购物，则弹出提示，首先，在<code>ProductPage.tsx</code>中导入<code>Prompt</code>组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Prompt, RouteComponentProps &#125; from &quot;react-router-dom&quot;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>添加对应触发条件即可，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">  &lt;Prompt when=&#123;!this.state.added&#125; message=&#123;this.navAwayMessage&#125; /&gt;</span><br><span class="line">  ...</span><br><span class="line">    private navAwayMessage = () =&gt; &quot;Are you sure you leave without buying this product?&quot;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2><span id="nested-routes">Nested routes</span></h2>
<p>内嵌路由就是在某一个一级URL下渲染多个组件。</p>
<p>譬如我们想要创建一个3层渲染，</p>
<ul>
<li>第一层包含<code>Users</code>和<code>Products</code>的链接</li>
<li><code>Users</code>层又包含所有用户</li>
<li>点击每个用户可以看到具体信息</li>
</ul>
<ol>
<li>首先修改<code>AdminPage.tsx</code>，导入向导组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; NavLink, Route, RouteComponentProps &#125; from &quot;react-router-dom&quot;;</span><br></pre></td></tr></table></figure>
<ul>
<li>我们将会使用<code>NavLink</code>组件渲染菜单</li>
<li><code>Route</code>用于内嵌路由</li>
<li><code>RouteComponentProps</code>类型将会获取URL的参数id</li>
</ul>
<ol start="2">
<li>将<code>p</code>标签内容替换为下面…</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">  &lt;h1&gt;Admin Panel&lt;/h1&gt;</span><br><span class="line">  &lt;ul className=&quot;admin-sections&quot;&gt;</span><br><span class="line">	&lt;li key=&quot;users&quot; &gt;</span><br><span class="line">		&lt;NavLink to=&#123;`/admin/user`&#125; activeClassName=&quot;admin-link-active&quot;&gt;Users&lt;/NavLink&gt;</span><br><span class="line">	&lt;/li&gt;</span><br><span class="line">	&lt;li key=&quot;products&quot;&gt;</span><br><span class="line">		&lt;NavLink to=&#123;`/admin/products`&#125; activeClassName=&quot;admin-link-active&quot;&gt;Products&lt;/NavLink&gt;</span><br><span class="line">	&lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>添加对应样式…</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.admin-sections &#123;</span><br><span class="line">  list-style: none;</span><br><span class="line">  margin: 0px 0px 20px 0px;</span><br><span class="line">  padding: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.admin-sections li &#123;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  margin-right: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.admin-sections li a &#123;</span><br><span class="line">  color: #222;</span><br><span class="line">  text-decoration: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.admin-link-active &#123;</span><br><span class="line">  border-bottom: #6f6e6e solid 2px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>回到原来的<code>AdminPage.tsx</code>，添加两个路由组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">  &lt;h1&gt;Admin Panel&lt;/h1&gt;</span><br><span class="line">  &lt;ul className=&quot;admin-sections&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">  &lt;Route path=&quot;/admin/users/:id&quot; component=&#123;AdminUsers&#125; /&gt;</span><br><span class="line">  &lt;Route path=&quot;/admin/products&quot; component=&#123;AdminProducts&#125; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>创建这两个路由组件，在<code>AdminPage.tsx</code>内添加，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const AdminProducts: React.SFC = () =&gt; &#123;</span><br><span class="line">  return &lt;div&gt;Some options to administer products&lt;/div&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>接下来的<code>AdminUsers</code>组件可能会复杂一些。首先定义一种数据结构，在<code>AdminPage.tsx</code>的组件<code>AdminProducts</code>下，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface IUser &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  name: string;</span><br><span class="line">  isAdmin: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const adminUsersData: IUser[] = [</span><br><span class="line">  &#123; id: 1, name: &quot;Fred&quot;, isAdmin: true &#125;,</span><br><span class="line">  &#123; id: 2, name: &quot;Bob&quot;, isAdmin: false &#125;,</span><br><span class="line">  &#123; id: 3, name: &quot;Jane&quot;, isAdmin: true &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>这样一来就有3个用户了。</p>
<ol start="7">
<li>接下来实现<code>AdminUsers</code>组件的内容，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const AdminUsers: React.SFC = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ul className=&quot;admin-sections&quot;&gt;</span><br><span class="line">        &#123;adminUsersData.map(user =&gt; (</span><br><span class="line">          &lt;li&gt;</span><br><span class="line">            &lt;NavLink</span><br><span class="line">              to=&#123;`/admin/users/$&#123;user.id&#125;`&#125;</span><br><span class="line">              activeClassName=&quot;admin-link-active&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &#123;user.name&#125;</span><br><span class="line">            &lt;/NavLink&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>该组件会渲染每个用户名的链接。它是一个内嵌路径，</p>
<ol start="8">
<li>另外，还需要定义另外一个路由展示用户详细信息。添加一个路由，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">&lt;ul className=&quot;admin-sections&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;Route path=&quot;/admin/users/:id&quot; component=&#123;AdminUser&#125; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ol start="9">
<li>这个<code>AdminUser</code>也还没有实现，因此，在<code>AdminUsers</code>组件下面添加上，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const AdminUser: React.SFC&lt;RouteComponentProps&lt;&#123; id: string &#125;&gt;&gt; = props =&gt; &#123;</span><br><span class="line">  return null;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们用到了<code>RouteComponentProps</code>通过<code>id</code>来获取可用的属性。</p>
<ol start="10">
<li>然后通过<code>id</code>获取定义的<code>adminUsersData</code>中的记录，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const AdminUser: React.SFC&lt;RouteComponentProps&lt;&#123; id: string &#125;&gt;&gt; = props =&gt; &#123;</span><br><span class="line">  let user: IUser;</span><br><span class="line">  if (props.match.params.id) &#123;</span><br><span class="line">    const id: number = parseInt(props.match.params.id, 10);</span><br><span class="line">    user = adminUsersData.filter(u =&gt; u.id === id)[0];</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">  return null;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="11">
<li>有了<code>user</code>对象后，渲染其内容，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const AdminUser: React.SFC&lt;RouteComponentProps&lt;&#123; id: string &#125;&gt;&gt; = props =&gt; &#123;</span><br><span class="line">  let user: IUser;</span><br><span class="line">  if (props.match.params.id) &#123;</span><br><span class="line">    const id: number = parseInt(props.match.params.id, 10);</span><br><span class="line">    user = adminUsersData.filter(u =&gt; u.id === id)[0];</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;b&gt;Id: &lt;/b&gt;</span><br><span class="line">        &lt;span&gt;&#123;user.id.toString()&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;b&gt;Is Admin: &lt;/b&gt;</span><br><span class="line">        &lt;span&gt;&#123;user.isAdmin.toString()&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="12">
<li>再次运行，进入到<code>Admin</code>页面，点击<code>Products</code>… 点击<code>Users</code>…</li>
</ol>
<p>因此，如果需要实现内嵌路由，需要用到<code>NavLink</code>或<code>Link</code>组件，以及使用<code>Route</code>组件渲染这些内容。</p>
<h2><span id="animated-transitions">Animated transitions</span></h2>
<p>本小节将给不同的导航添加动画。我们会使用<code>react-transition-group</code>中的<code>TransitionGroup</code>和<code>CSSTransition</code>组件，步骤如下，</p>
<ol>
<li>首先安装对应这些包，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install react-transition-group</span><br><span class="line">npm install @types/react-transition-group --save-dev</span><br></pre></td></tr></table></figure>
<p><code>TransitionGroup</code> 会持续跟踪它内部本地state的子组，并计算子组进入和退出。<code>CSSTransition</code>则在<code>TransitionGroup</code>子组离开或退出时，提供CSS类来表示一种状态。</p>
<p>因此，<code>TransitionGroup</code>和<code>CSSTransition</code>可以包装我们的路由，并调用CSS类，</p>
<ol start="2">
<li>首先我们需要在我们的<code>Routes.tsx</code>中导入这些组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; CSSTransition, TransitionGroup &#125; from &quot;react-transition-group&quot;;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>我们还需要路由属性，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Redirect, Route, RouteComponentProps, Switch &#125; from &quot;react-router-dom&quot;;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>作用我们的<code>Route</code>组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const Routes: React.SFC&lt;RouteComponentProps&gt; = props =&gt; &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>用<code>CSSTransition</code>和<code>TransitionGroup</code>来包装我们的路由，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;TransitionGroup&gt;</span><br><span class="line">  &lt;CSSTransition</span><br><span class="line">	key=&#123;props.location.key&#125;</span><br><span class="line">	timeout=&#123;500&#125;</span><br><span class="line">	classNames=&quot;animate&quot;</span><br><span class="line">  &gt;</span><br><span class="line">	&lt;Switch&gt;</span><br><span class="line">	  &lt;Redirect exact=&#123;true&#125; from=&quot;/&quot; to=&quot;/products&quot; /&gt;</span><br><span class="line">	  &lt;Route exact=&#123;true&#125; path=&quot;/products&quot; component=&#123;ProductsPage&#125; /&gt;</span><br><span class="line">	  &lt;Route path=&quot;/products/:id&quot; component=&#123;ProductPage&#125; /&gt;</span><br><span class="line">	  &lt;Route path=&quot;/admin&quot;&gt;</span><br><span class="line">		&#123;loggedIn ? &lt;AdminPage /&gt; : &lt;Redirect to=&quot;/login&quot; /&gt;&#125;</span><br><span class="line">	  &lt;/Route&gt;</span><br><span class="line">	  &lt;Route path=&quot;/login&quot; component=&#123;LoginPage&#125; /&gt;</span><br><span class="line">	  &lt;Route component=&#123;NotFoundPage&#125; /&gt;</span><br><span class="line">	&lt;/Switch&gt;</span><br><span class="line">  &lt;/CSSTransition&gt;</span><br><span class="line">&lt;/TransitionGroup&gt;</span><br></pre></td></tr></table></figure>
<p><code>TransitionGroup</code>要求子组要有一个唯一的<code>key</code>决定退出和进入的动作。因此我们在<code>CSSTransition</code>上指定<code>key</code>属性为<code>RouteComponentProps</code>上的<code>location.key</code>。我们设置了transtion的timeout属性为半秒，以及它的样式类。</p>
<ol start="6">
<li>接下来，我们需要添加这些CSS类到<code>index.css</code>中，</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.animate-enter</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.animate-enter-active</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">450ms</span> ease-in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.animate-exit</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当它的<code>key</code>改变时，<code>CSSTransition</code>会调用这些CSS样式。</p>
<ol start="7">
<li>因为我们不能在<code>Router</code>组件外部使用高阶组件<code>withRouter</code>。要解决这个问题，可以添加一个新的组件<code>RoutesWrap</code>进行包装，在原来的<code>Routes.tsx</code>中添加，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const RoutesWrap: React.SFC = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">      &lt;Route component=&#123;Routes&#125; /&gt;</span><br><span class="line">    &lt;/Router&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Routes extends React.Component&lt;RouteComponentProps,</span><br><span class="line">IState&gt; &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">export default RoutesWrap;</span><br></pre></td></tr></table></figure>
<ol start="8">
<li>在<code>Routes</code>组件中移除<code>Router</code>，让<code>div</code>标签作为它的根。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public render() &#123;</span><br><span class="line">return (</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;Header /&gt;</span><br><span class="line">&lt;TransitionGroup&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/TransitionGroup&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">);</span><br><span class="line">&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">再次执行程序，可以看到进入不同页面是有一种渐退效果。</span><br><span class="line"></span><br><span class="line">## Lazy loading routes</span><br><span class="line"></span><br><span class="line">截至目前为止，所有JavaScript会在app第一次加载时全部加载。包括`Admin`这些我们不需要的页面。这一点会造成一些资源浪费。所以需要用到一种称为“lazy loading”的组件。</span><br><span class="line"></span><br><span class="line">1. 首先我们需要导入`Suspense`这个组件，</span><br><span class="line"></span><br><span class="line">```tsx</span><br><span class="line">import &#123; Suspense &#125; from &quot;react&quot;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>接着以另一种方式导入这个<code>AdminPage</code>组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const ADminPage = React.lazy(() =&gt; import(&quot;./AdminPage&quot;));</span><br></pre></td></tr></table></figure>
<p>我们使用了React的一个函数<code>lazy</code>，它接收一个函数并返回一个动态导入，换句话说就是指派了一个<code>AdminPage</code>组件变量。</p>
<ol start="3">
<li>上面步骤会获得一个lint错误，<strong>A dynamic import call in ES5/ES3 requires the ‘Promise’ constructor. Make sure you have a declaration for the ‘Promise’ constructor or include ‘ES2015’ in your <code>--lib</code> option.</strong> 需要在<code>tsconfig.json</code>中添加<code>lib</code>选项。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;lib&quot;</span>: [<span class="string">&quot;es6&quot;</span>, <span class="string">&quot;dom&quot;</span>],</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>接下来的内容是，使用<code>Suspense</code>组件包装这个<code>AdminPage</code>组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=&quot;/admin&quot;&gt;</span><br><span class="line">&#123;loggedIn ? (</span><br><span class="line">&lt;Suspense fallback=&#123;&lt;div className=&quot;pagecontainer&quot;&gt;</span><br><span class="line">Loading...&lt;/div&gt;&#125;&gt;</span><br><span class="line">&lt;AdminPage /&gt;</span><br><span class="line">&lt;/Suspense&gt;</span><br><span class="line">) : (</span><br><span class="line">&lt;Redirect to=&quot;/login&quot; /&gt;</span><br><span class="line">)&#125;</span><br><span class="line">&lt;/Route&gt;</span><br></pre></td></tr></table></figure>
<p><code>Suspense</code>组件会在<code>AdminPage</code>被加载时，展示这个<code>div</code>部分内容。有点说明的是，组件加载非常快，可能实际浏览器看了没效果，需要进入<strong>Network</strong>选择<strong>Slow 3G</strong>网络环境模式。刷新页面便可看到出现Loading…</p>
<h2><span id="总结">总结</span></h2>
<p>React Router给我们一套全面的组件管理导航页。最先学习的是底层组件<code>Router</code>，它会查找下游的<code>Route</code>组件并根据路径进行渲染。</p>
<p><code>Link</code>组件让我们在应用中链接到不同的页面。我们学习了<code>NavLinke</code>和<code>Link</code>相似，但提供了对不同激活路径的样式功能。因此<code>NavLink</code>最大好处用在侧边栏或标头横幅，<code>Link</code>用在内嵌页面跳转。</p>
<p><code>RouteComponentProps</code>是一种泛型类型，它提供了访问路径参数的能力。我们还发现了React Router并不能解析路径参数，但可以使用本地的JavaScript的<code>URLSearchParams</code>实现。</p>
<p><code>Redirect</code>组件提供了路径重定向的功能。这非常适用于对权限页面的控制。</p>
<p><code>Prompt</code>组件提供了弹窗的能力。</p>
<p>我们还学习了通过使用<code>TransitionGroup</code>和<code>CSSTransition</code>组件，通过包装我们的<code>Route</code>组件实现一种渐退的效果。</p>
<p>另外我们还学习了使用<code>Suspense</code>组件配合React的<code>lazy</code>函数，对不同的页面实现延迟加载，帮助我们提升应用的性能效果。</p>
</div></article><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2019/11/27/react-ts/chapter_4_Routing_with_React_Router/';
var disqus_title = '第四章 React Router';
var disqus_url = 'http://galudisu.info/2019/11/27/react-ts/chapter_4_Routing_with_React_Router/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>©2016 - 2021 <a href="http://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>

<link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css">

<script src="/js/base.js"></script>

<script src="/js/rabbit-lyrics.js"></script>
</div></body></html>