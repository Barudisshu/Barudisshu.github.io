<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>第七章 表单</title><link rel="stylesheet" href="/css/layout.css">
<!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/vendors/rabbit-lyrics.css"><link rel="shortcut icon" href="/img/favicon.ico"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">简单易懂の现代魔法</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="http://weibo.com/u/2360401155" class="menu-link">Weibo</a></li><li class="menu-item"><a href="/about" class="menu-link">About</a></li><li class="menu-item"><a href="/atom.xml" class="menu-link">Rss</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">简单易懂の现代魔法</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="http://weibo.com/u/2360401155" class="menu-link">Weibo</a></li><li class="menu-item"><a href="/about" class="menu-link">About</a></li><li class="menu-item"><a href="/atom.xml" class="menu-link">Rss</a></li></ul></nav><div id="mobile-menu-toggle" class="toggle-menu"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">第七章 表单</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title"></span><i class="icon-calendar"> </i>2019-11-27</p><p class="meta-item meta-tag"><span class="meta-item-title"></span><i class="icon-tags"> </i><a href="/tags/react/" class="tag-link">react<span class="tag">, </span></a><a href="/tags/typescript/" class="tag-link">typescript</a></p><p class="meta-item meta-category"><span class="meta-item-title"></span><i class="icon-bookmark"> </i><a href="/categories/react/" class="category-link">react</a></p></div><div class="article-content"><ul>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><li>creating a form with controlled components</li>
<li>Reducing boilerplate code with generic components</li>
<li>Validating forms</li>
<li>Form submission</li>
</ul>
<h2><span id="creating-a-form-with-controlled-components">Creating a form with controlled components</span></h2>
<p>表单是大部分应用的常见内容。在React中，创建表单的标准方式是使用被称为 <em>controlled component</em> 的组件。</p>
<h3><span id="adding-a-contact-us-page">Adding a Contact Us page</span></h3>
<p>在src目录添加一个新的文件<code>ContactUsPage.tsx</code>，内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">class ContactUsPage extends React.Component &#123;</span><br><span class="line">	public render() &#123;</span><br><span class="line">		return (</span><br><span class="line">			&lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">				&lt;h1&gt;Contact Us&lt;/h1&gt;</span><br><span class="line">				&lt;p&gt;</span><br><span class="line">					If you enter your details we&apos;ll get back to you as soon as we can.</span><br><span class="line">				&lt;/p&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default ContactUsPage;</span><br></pre></td></tr></table></figure>
<p>该组件需要包含状态，目前首先创建了header相关信息。接下来，导入该组件到页面中，打开<code>Routes.tsx</code>，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import ContactUsPage from &quot;./ContactUsPage&quot;;</span><br></pre></td></tr></table></figure>
<p>在<code>Routes</code>组件的<code>render</code>方法中，添加新的路由，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;Switch&gt;</span><br><span class="line">	&lt;Redirect exact=&#123;true&#125; from=&quot;/&quot; to=&quot;/products&quot; /&gt;</span><br><span class="line">	&lt;Route path=&quot;/products/:id&quot; component=&quot;&#123;ProductPage&#125; /&gt;</span><br><span class="line">	&lt;Route exact=&#123;true&#125; path=&quot;/products&quot; compoent=&#123;ProductsPage&#125; /&gt;</span><br><span class="line">	&lt;Route path=&quot;contactus&quot; component=&#123;ContactUsPage&#125; /&gt;</span><br><span class="line">	&lt;Route path=&quot;/admin&quot;&gt;</span><br><span class="line">	  ...</span><br><span class="line">    &lt;/Route&gt;</span><br><span class="line">	&lt;Route path=&quot;/login&quot; compoent=&#123;LoginPage&#125; /&gt;</span><br><span class="line">	&lt;Route component=&#123;NotFoundPage&#125; /&gt;</span><br><span class="line">&lt;/Switch&gt;</span><br></pre></td></tr></table></figure>
<p>打开<code>Header.tsx</code>，添加新的导航信息，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;nav&gt;</span><br><span class="line">	&lt;NavLink to=&quot;/products&quot; className=&quot;header-link&quot; activeClassName=&quot;header-link-active&quot;&gt;</span><br><span class="line">	  Products</span><br><span class="line">	&lt;/NavLink&gt;</span><br><span class="line">	&lt;NavLink to=&quot;/contactus&quot; className=&quot;header-link&quot; activeClassName=&quot;header-link-active&quot;&gt;</span><br><span class="line">	  Contact Us</span><br><span class="line">	&lt;/NavLink&gt;</span><br><span class="line">	&lt;NavLink to=&quot;/admin&quot; className=&quot;header-link&quot; activeClassName=&quot;header-link-active&quot;&gt;</span><br><span class="line">	  Admin</span><br><span class="line">	&lt;/NavLink&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<p>现在，页面已经创建了，下面创建表单输入框。</p>
<h2><span id="creating-controlled-inputs">Creating controlled inputs</span></h2>
<p>在src目录下创建一个新文件<code>ContactUs.tsx</code>，包含下面内容，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const ContactUs: React.SFC = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;form className=&quot;form&quot; noValidate=&#123;true&#125;&gt;</span><br><span class="line">	  &lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">	    &lt;label htmlFor=&quot;name&quot;&gt;Your name&lt;/label&gt;</span><br><span class="line">		&lt;input type=&quot;text&quot; id=&quot;name&quot; /&gt;</span><br><span class="line">	  &lt;/div&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default ContactUs;</span><br></pre></td></tr></table></figure>
<p>这是一个功能组件，渲染一个表单包含label和用户名的输入框。</p>
<p>现在需要添加对应的css样式，</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.form</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0px</span> auto <span class="number">0px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.form-group</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.form-group</span> <span class="selector-tag">label</span> &#123;</span><br><span class="line">  <span class="attribute">align-self</span>: flex-start;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.form-group</span> <span class="selector-tag">input</span>, <span class="selector-tag">select</span>, <span class="selector-tag">textarea</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: Arial, Helvetica, sans-serif;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">border</span>: lightgray solid <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在在我们页面<code>ContactUsPage.tsx</code>添加并渲染表单，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import ContactUs from &quot;./ContactUs&quot;;</span><br></pre></td></tr></table></figure>
<p>在<code>render</code>方法中添加，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">  &lt;h1&gt;Contact Us&lt;/h1&gt;</span><br><span class="line">  &lt;p&gt;If you enter your details we&apos;ll get back to you as soon as we can.&lt;/p&gt;</span><br><span class="line">  &lt;ContactUs /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>表单已经创建好了，但需要创建一个状态类型到<code>ContactUsPage</code>页面中，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface IState &#123;</span><br><span class="line">  name: string;</span><br><span class="line">  email: string;</span><br><span class="line">  reason: string;</span><br><span class="line">  notes: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ContactUsPage extends React.Component&lt;&#123;&#125;, IState&gt; &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>在构造器中初始化状态，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public constructor(props: &#123;&#125;) &#123;</span><br><span class="line">  super(props);</span><br><span class="line">  this.state = &#123;</span><br><span class="line">    email: &quot;&quot;,</span><br><span class="line">	name: &quot;&quot;,</span><br><span class="line">	notes: &quot;&quot;,</span><br><span class="line">	reason: &quot;&quot;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们需要将<code>ContactUsPage</code>中的状态传递到<code>ContactUs</code>组件中。在<code>ContactUs</code>组件中，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface IProps &#123;</span><br><span class="line">  name: string;</span><br><span class="line">  email: string;</span><br><span class="line">  reason: string;</span><br><span class="line">  notes: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const ContactUs: React.SFC&lt;IProps&gt; = props =&gt; &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>将表单名name绑定到<code>name</code>属性中，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">  &lt;label htmlFor=&quot;name&quot;&gt;Your name&lt;/label&gt;</span><br><span class="line">  &lt;input type=&quot;text&quot; id=&quot;name&quot; value=&#123;props.name&#125; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>将表单状态传递给<code>ContactUsPage</code>，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ContactUs</span><br><span class="line">  name=&#123;this.state.name&#125;</span><br><span class="line">  emial=&#123;this.state.email&#125;</span><br><span class="line">  reason=&#123;this.state.reason&#125;</span><br><span class="line">  notes=&#123;this.state.notes&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>添加事件监听，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; id=&quot;name&quot; value=&#123;props.name&#125; onChange=&#123;handleNameChange&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>创建对应的handler，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const ContactUs: React.SFC&lt;IProps&gt; = props =&gt; &#123;</span><br><span class="line">  const handleNameChange = (e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; &#123;</span><br><span class="line">    props.onNameChange(e.currentTarget.value);</span><br><span class="line">  &#125;;</span><br><span class="line">  return ( ... );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这是使用到了<code>React.ChangeEvent</code>。我们需要添加<code>onNameChange</code>函数到IProps中，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface IProps &#123;</span><br><span class="line">  name: string;</span><br><span class="line">  onNameChange: (name: string) =&gt; void;</span><br><span class="line">  email: string;</span><br><span class="line">  onEmailChange: (email: string) =&gt;void;</span><br><span class="line">  reason: string;</span><br><span class="line">  onReasonChange: (reason: string) =&gt; void;</span><br><span class="line">  notes: string;</span><br><span class="line">  onNotesChange: (notes: string) =&gt; void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在需要将来自<code>ContactUsPage</code>的Props传递到<code>ContactUs</code>中，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;ContactUs</span><br><span class="line">  name=&#123;this.state.name&#125;</span><br><span class="line">  onNameChange=&#123;this.handleNameChange&#125;</span><br><span class="line">  email=&#123;this.state.email&#125;</span><br><span class="line">  onEmailChange=&#123;this.handleEmailChange&#125;</span><br><span class="line">  reason=&#123;this.state.reason&#125;</span><br><span class="line">  onReasonChange=&#123;this.handleReasonChange&#125;</span><br><span class="line">  notes=&#123;this.state.notes&#125;</span><br><span class="line">  onNotesChange=&#123;this.handleNotesChange&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来创建对应的handlers方法，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private handleNameChange = (name: string =&gt; &#123;</span><br><span class="line">  this.setState(&#123; name &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">private handleEmailChange = (email: string) =&gt; &#123;</span><br><span class="line">  this.setState(&#123; email &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">private handleReasonChange = (reason: string) =&gt; &#123;</span><br><span class="line">  this.setState(&#123; reason &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">private handleNotesChange = (notes: string) =&gt; &#123;</span><br><span class="line">  this.setState(&#123; notes &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>接下来在<code>ContactUs</code>中补充其它表单内容，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;form className=&quot;form&quot; noValidate=&#123;true&#125;&gt;</span><br><span class="line">  &lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">    &lt;label htmlFor=&quot;name&quot;&gt;Your name&lt;/label&gt;</span><br><span class="line">    &lt;input</span><br><span class="line">      type=&quot;text&quot;</span><br><span class="line">      id=&quot;name&quot;</span><br><span class="line">      value=&#123;props.name&#125;</span><br><span class="line">      onChange=&#123;handleNameChange&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">    &lt;label htmlFor=&quot;email&quot;&gt;Your email address&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;email&quot; value=&#123;props.email&#125; onChange=&#123;handleEmailChange&#125; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">    &lt;label htmlFor=&quot;reason&quot;&gt;Reason you need to contact us&lt;/label&gt;</span><br><span class="line">    &lt;select id=&quot;reason&quot; value=&#123;props.reason&#125; onChange=&#123;handleReasonChange&#125;&gt;</span><br><span class="line">      &lt;option value=&quot;Marketing&quot;&gt;Marketing&lt;/option&gt;</span><br><span class="line">      &lt;option value=&quot;Support&quot; selected=&#123;true&#125;&gt;Support&lt;/option&gt;</span><br><span class="line">      &lt;option value=&quot;Feedback&quot;&gt;Feedback&lt;/option&gt;</span><br><span class="line">      &lt;option value=&quot;Jobs&quot;&gt;Jobs&lt;/option&gt;</span><br><span class="line">      &lt;option value=&quot;Other&quot;&gt;Other&lt;/option&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">    &lt;label htmlFor=&quot;notes&quot;&gt;Additional notes&lt;/label&gt;</span><br><span class="line">    &lt;textarea id=&quot;notes&quot; value=&#123;props.notes&#125; onChange=&#123;handleNotesChange&#125; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>现在创建这些handler的函数属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const handleEmailChange = (e: React.ChangeEvent&lt;HTMLInputElement&gt;)</span><br><span class="line">=&gt; &#123;</span><br><span class="line">props.onEmailChange(e.currentTarget.value);</span><br><span class="line">&#125;;</span><br><span class="line">const handleReasonChange = (e:</span><br><span class="line">React.ChangeEvent&lt;HTMLSelectElement&gt;) =&gt; &#123;</span><br><span class="line">props.onReasonChange(e.currentTarget.value);</span><br><span class="line">&#125;;</span><br><span class="line">const handleNotesChange = (e:</span><br><span class="line">React.ChangeEvent&lt;HTMLTextAreaElement&gt;) =&gt; &#123;</span><br><span class="line">props.onNotesChange(e.currentTarget.value);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2><span id="reducing-boilerplate-code-with-generic-components">Reducing boilerplate code with generic components</span></h2>
<p>通用表单组件将有利于减少表单代码的重复实现。我们重构上面的<code>ContactUs</code>组件来实现generic form components。</p>
<p>假设我们希望，理想情况下消费组件<code>ContactUs</code>内容的generic component组件的形式如下，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;Form</span><br><span class="line">defaultValues=&#123;&#123; name: &quot;&quot;, email: &quot;&quot;, reason: &quot;Support&quot;, notes: &quot;&quot; &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">&lt;Form.Field name=&quot;name&quot; label=&quot;Your name&quot; /&gt;</span><br><span class="line">&lt;Form.Field name=&quot;email&quot; label=&quot;Your email address&quot; type=&quot;Email&quot; /&gt;</span><br><span class="line">&lt;Form.Field name=&quot;reason&quot; label=&quot;Reason you need to contact us&quot;</span><br><span class="line">type=&quot;Select&quot; options=&#123;[&quot;Marketing&quot;, &quot;Support&quot;, &quot;Feedback&quot;, &quot;Jobs&quot;,</span><br><span class="line">&quot;Other&quot;]&#125; /&gt;</span><br><span class="line">&lt;Form.Field name=&quot;notes&quot; label=&quot;Additional notes&quot; type=&quot;TextArea&quot; /&gt;</span><br><span class="line">&lt;/Form&gt;</span><br></pre></td></tr></table></figure>
<p>在这个示例中，有两个通用合成组件：<code>Form</code>和<code>Field</code>。它们有某些特点，</p>
<ul>
<li><code>Form</code>组件是用于合成、管理状态和交互的。</li>
<li><code>Fomr</code>组件使用<code>defaultValues</code>属性来传递默认值。</li>
<li><code>Field</code>组件渲染label和每个字段的一个编辑器。</li>
<li>每个字段包含一个<code>name</code>属性，并被存储在对应的state属性名内。</li>
<li>每个字段有一个<code>label</code>属性用于展示每个字段的标签。</li>
<li>特殊字段用<code>type</code>属性标识。默认的属性为文本类型<code>input</code>。</li>
<li>如果编辑器类型是<code>Select</code>，我们可以通过<code>options</code>属性指定。</li>
</ul>
<p>新版本的<code>ContactUs</code>组件相比原来的更简短、更易用。状态的管理和事件的处理被隐藏和封装在<code>Form</code>组件内。</p>
<h3><span id="creating-a-basic-form-component">Creating a basic form component</span></h3>
<p>下面开始构建我们的通用<code>Form</code>组件；</p>
<ol>
<li>在<code>src</code>文件夹下创建一个新的文件<code>Form.tsx</code>，包含下面内容：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">interface IFormProps &#123;&#125;</span><br><span class="line"></span><br><span class="line">interface IState &#123;&#125;</span><br><span class="line"></span><br><span class="line">export class Form extends React.Component&lt;IFormProps, IState&gt; &#123;</span><br><span class="line">  constructor(props: IFormProps) &#123;&#125;</span><br><span class="line">  public render() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Form</code>是一个基类组件，因为它需要管理状态。我们将属性接口命名为<code>IFormProps</code>，因为之后我们将需要一个字段属性的接口。</p>
<ol start="2">
<li>添加一个<code>defaultValues</code>属性到<code>IFormProps</code>接口中，它为每个字段提供默认值，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export interface IValues &#123;</span><br><span class="line">  [key: string]: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IFormProps &#123;</span><br><span class="line">  defaultValues: IValues;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们使用一个额外的接口<code>IValues</code>，它是一个索引的key/value类型<code>[key: string]: any</code>，key是字段名，value是字段值。</p>
<p>因此，<code>defaultValues</code>属性可以是，</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; name: "", email: "", reason: "Support", notes: "" &#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>对于表单的state，需要存储这个接口类型，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface IState &#123;</span><br><span class="line">  values: IValues;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>接下来需要在构造方法中初始化组件的状态，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">constructor(props: IFormProps) &#123;</span><br><span class="line">  super(props);</span><br><span class="line">  this.state =  &#123;</span><br><span class="line">    values: props.defaultValues</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>最后一步，实现<code>render</code>方法，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public render() &#123;</span><br><span class="line">  return (</span><br><span class="line">  &lt;form className=&quot;form&quot; noValidate=&#123;true&#125;&gt;</span><br><span class="line">  &#123;this.props.children&#125;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在<code>form</code>标签中渲染子组件，使用了<code>children</code>属性。</p>
<p>接下来，我们需要实现我们的<code>Field</code>组件。</p>
<h3><span id="adding-a-basic-field-component">Adding a basic Field component</span></h3>
<p><code>Field</code>组件需要渲染一个标签(label)和一个编辑框(editor)。</p>
<ol>
<li>首先在<code>Form.tsx</code>中创建一个接口属性，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface IFieldProps &#123;</span><br><span class="line">  name: string;</span><br><span class="line">  label: string;</span><br><span class="line">  type?: &quot;Text&quot; | &quot;Email&quot; | &quot;Select&quot; | &quot;TextArea&quot;;</span><br><span class="line">  options?: string[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>name</code>表示字段名</li>
<li><code>label</code>是展示标签</li>
<li><code>type</code>输入类型，可选</li>
<li><code>options</code>，仅作用于当<code>type</code>是<code>Select</code>时，可选</li>
</ul>
<ol start="2">
<li>现在添加<code>Field</code>属性字段的骨架，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static Field: React.SFC&lt;IFieldProps&gt; = props =&gt; &#123;</span><br><span class="line">  return ();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>另外，首先添加<code>type</code>字段的默认属性，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Form.Field.defaultProps = &#123;</span><br><span class="line">  type: &quot;Text&quot;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样，默认的<code>type</code>是一个文本类型，</p>
<ol start="4">
<li>现在，渲染它的内容，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public static Field: React.SFC&lt;IFieldProps&gt; = props =&gt; &#123;</span><br><span class="line">  const &#123; name, label, type, options &#125; = props;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">	  &lt;label htmlFor=&#123;name&#125;&gt;&#123;label&#125;&lt;/label&gt;</span><br><span class="line">	  &lt;input type=&#123;type.toLowerCase()&#125; id=&#123;name&#125; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  ）；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这虽然是好的开头，但是，仅使用<code>Text</code>和<code>Email</code>类型。</p>
<ol start="5">
<li>因此，需要添加合适的条件进行渲染，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;type === &quot;TextArea&quot; ... &#125;</span><br><span class="line"></span><br><span class="line">&#123;type === &quot;Select&quot; &amp;&amp; (</span><br><span class="line">  &lt;select&gt;</span><br><span class="line">    &#123;options &amp;&amp;</span><br><span class="line">      options.map(option =&gt; (</span><br><span class="line">        &lt;option key=&#123;option&#125; value=&#123;option&#125;&gt;</span><br><span class="line">          &#123;option&#125;</span><br><span class="line">        &lt;/option&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">   &lt;/select&gt;</span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="sharing-state-with-react-context">Sharing state with React context</span></h3>
<p><code>Form</code>组件内的字段值状态，需要在<code>Field</code>组件内共享，即可以通过<code>Field</code>组件访问和修改。</p>
<ol>
<li>首先在<code>Form.tsx</code>创建一个接口，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface IFormContext &#123;</span><br><span class="line">  values: IValues;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在<code>IFormContext</code>下使用<code>React.createContext</code>创建一个上下文创建(context component)，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const FormContext = React.createContext&lt;IFormContext&gt;(&#123;</span><br><span class="line">  values: &#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>在<code>Form</code>的<code>render</code>方法中，创建包含上下文的值，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public render() &#123;</span><br><span class="line">  const context: IFormContext = &#123;</span><br><span class="line">    values: this.state.values</span><br><span class="line">  &#125;;</span><br><span class="line">  return ( ... )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>包装表单标签，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;FormContext.Provider value=&#123;context&#125;&gt;</span><br><span class="line">  &lt;form ... &gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/FormContext.Provider&gt;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>在<code>Field</code>上下文进行消费，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;FormContext.Consumer&gt;</span><br><span class="line">  &#123;context =&gt; (</span><br><span class="line">    &lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/FormContext.Consumer&gt;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>现在可以访问这些上下文了，下面补充剩余的输入框，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">  &lt;label htmlFor=&#123;name&#125;&gt;&#123;label&#125;&lt;/label&gt;</span><br><span class="line">  &#123;(type === &quot;Text&quot; || type === &quot;Email&quot;) &amp;&amp; (</span><br><span class="line">     &lt;input type=&#123;type.toLowerCase() id=&#123;name&#125; value=&#123;context.values[name]&#125; /&gt;</span><br><span class="line">   )&#125;</span><br><span class="line">   </span><br><span class="line">   &#123;type === &quot;TextArea&quot; &amp;&amp; (</span><br><span class="line">     &lt;textarea id=&#123;name&#125; value=&#123;context.values[name]&#125; /&gt;</span><br><span class="line">   )&#125;</span><br><span class="line">   </span><br><span class="line">   &#123;type === &quot;Select&quot; &amp;&amp; (</span><br><span class="line">     &lt;select value=&#123;context.values[name]&#125;&gt;</span><br><span class="line">	 ...</span><br><span class="line">	 &lt;/select&gt;</span><br><span class="line">   )&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>目前还没有添加事件用于更新上下文的状态，需要实现相应的事件处理机制。</p>
<ol start="7">
<li>在<code>Form</code>类中创建一个<code>setValue</code>方法，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private setValue = (fieldName: string, value: any) =&gt; &#123;</span><br><span class="line">  const newValues = &#123; ...this.state.values, [fieldName]: value &#125;;</span><br><span class="line">  this.setState(&#123; values: newValues &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>该方法包含有：</p>
<ul>
<li>该方法接收fieldName和value作为参数。</li>
<li>状态被更新为<code>newValues</code>，旧的值被更新，没有则添加。</li>
<li>新值被更新了。</li>
</ul>
<ol start="8">
<li>接下来在<code>Field</code>组件中创建该方法的一个上下文属性，以实现访问，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface IFormContext &#123;</span><br><span class="line">  values: IValues;</span><br><span class="line">  setValue?: (fieldName: string, value: any) =&gt; void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="9">
<li>对应地，在<code>Form</code>组件也创建一个上下文属性，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const context: IFormContext = &#123;</span><br><span class="line">  setValue: this.setValue,</span><br><span class="line">  values: this.state.values</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="10">
<li>现在可以在<code>Field</code>组件中访问该方法了。在<code>Field</code>中，即在解构(destucture)对象props后面，创建对应的事件Hnadler，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const &#123; name, label, type, options &#125; = props;</span><br><span class="line"></span><br><span class="line">const handleChange = (</span><br><span class="line">  e:</span><br><span class="line">    | React.ChangeEvent&lt;HTMLInputElement&gt;</span><br><span class="line">    | React.ChangeEvent&lt;HTMLTextAreaElement&gt;</span><br><span class="line">    | React.ChangeEvent&lt;HTMLSelectElement&gt;,</span><br><span class="line">  context: IFormContext</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  if (context.setValue) &#123;</span><br><span class="line">    context.setValue(props.name, e.currentTarget.value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>该方法有几个关键的地方：</p>
<ul>
<li>TypeScript的事件改变类型是<code>ChangeEvent&lt;T&gt;</code>，其中<code>T</code>是被处理的元素。</li>
<li>该方法的第一个参数<code>e</code>，对应事件类型，组合(union)了所有不同的输入框事件，方便对事件进行统一处理。</li>
<li>该方法的第二个参数是表单上线文。</li>
<li>方法体内加入了条件语句，以确保编译顺利。</li>
<li>调用<code>setValue</code>方法更新或添加新值。</li>
</ul>
<ol start="11">
<li>现在可以为<code>input</code>输入框添加这个事件处理，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;input </span><br><span class="line">  type=&#123;type.toLowerCase() &#125;</span><br><span class="line">  id=&#123;name&#125;</span><br><span class="line">  value=&#123;context.values[name] &#125;</span><br><span class="line">  onChange=&#123;e =&gt; handleChange(e, context) &#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<ol start="12">
<li>对于<code>textarea</code>标签，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;textarea</span><br><span class="line">  id=&#123;name&#125;</span><br><span class="line">  value=&#123;context.values[name]&#125;</span><br><span class="line">  onChange=&#123;e =&gt; handleChange(e, context) &#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<ol start="13">
<li>对于<code>select</code>标签，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;select</span><br><span class="line">  value=&#123;context.values[name] &#125;</span><br><span class="line">  onChange=&#123;e =&gt; handleChange(e, context) &#125;</span><br><span class="line">&gt;</span><br><span class="line"> ...</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>现在，我们的<code>Form</code>和<code>Field</code>组件可以组合在一起工作了。</p>
<h3><span id="implementing-our-new-contactus-component">Implementing our new ContactUs component</span></h3>
<p>接下来，我们使用<code>Form</code>和<code>Field</code>重新实现我们的<code>ContactUs</code>组件。</p>
<ol>
<li>
<p>首先删除<code>ContactUs.tsx</code>中的props，</p>
</li>
<li>
<p>重新定义<code>ContactUs</code>的SFC，</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const ContactUs: React.SFC = () =&gt; &#123;</span><br><span class="line">  return ();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>在<code>ContactUs.tsx</code>中导入<code>Form</code>组件，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Form &#125; from &quot;./Form&quot;;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>现在引用<code>Form</code>组件，带上默认值，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> return (</span><br><span class="line">   &lt;Form defaultValues=&#123;&#123; name: &quot;&quot;, email: &quot;&quot;, reason: &quot;Support&quot;, notes: &quot;&quot; &#125;&#125;</span><br><span class="line">&lt;/Form&gt;</span><br><span class="line"> );</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>添加<code>name</code>输入框，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Form defaultValues=&#123;&#123; name: &quot;&quot;, email: &quot;&quot;, reason: &quot;Support&quot;, notes: &quot;&quot; &#125;&#125;</span><br><span class="line">  &lt;Form.Field name=&quot;name&quot; label=&quot;Your name&quot; /&gt;</span><br><span class="line">&lt;/Form&gt;</span><br></pre></td></tr></table></figure>
<p>注意这个没有写<code>type</code>属性，则默认使用<code>text</code>填充，</p>
<ol start="6">
<li>下面补充<code>email</code>，<code>reason</code>和<code>notes</code>字段，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;Form defaultValues=&#123;&#123; name: &quot;&quot;, email: &quot;&quot;, reason: &quot;Support&quot;, notes: &quot;&quot; &#125;&#125;</span><br><span class="line">  &lt;Form.Field name=&quot;name&quot; label=&quot;Your name&quot; /&gt;</span><br><span class="line">  &lt;Form.Field name=&quot;email&quot; label=&quot;Your email address&quot; type=&quot;Email&quot; /&gt;</span><br><span class="line">  &lt;Form.Field</span><br><span class="line">    name=&quot;reason&quot;</span><br><span class="line">	label=&quot;Reason you need to contact us&quot;</span><br><span class="line">	type=&quot;Select&quot;</span><br><span class="line">	options=&#123;[&quot;Marketing&quot;, &quot;Support&quot;, &quot;Feedback&quot;, &quot;Jobs&quot;, &quot;Other&quot;]&#125;</span><br><span class="line">  /&gt;</span><br><span class="line">  &lt;Form.Field name=&quot;notes&quot; label=&quot;Additional notes&quot; type=&quot;TextArea&quot; /&gt;</span><br><span class="line">&lt;/Form&gt;</span><br></pre></td></tr></table></figure>
<p>接下来的<code>ContactUsPage</code>就变得简单了。它不需要包含任何状态(state)，因为状态的维护已经交由<code>Form</code>组件管理。我们也不需要传递任何属性(props)到<code>ContactUs</code>组件中，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class ContactUsPage extends React.Component&lt;&#123;&#125;, &#123;&#125;&gt; &#123;</span><br><span class="line">  public render() &#123;</span><br><span class="line">    return (</span><br><span class="line">	  &lt;div className=&quot;page-container&quot;&gt;</span><br><span class="line">	    &lt;h1&gt;Contact Us&lt;/h1&gt;</span><br><span class="line">		&lt;p&gt;</span><br><span class="line">		  If you enter your details we&apos;ll get back to you as soon as we can.</span><br><span class="line">	    &lt;/p&gt;</span><br><span class="line">	    &lt;ContactUs /&gt;</span><br><span class="line">	  &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目前为止这个通用组件变得易用并减少我们的重复代码，但还需添加表单验证的实现。</p>
<h2><span id="validating-forms">Validating forms</span></h2>
<p>为了提升用户体验，需要在表单中实现校验功能。</p>
<p>在<code>ContactUs</code>组件中我们需要实现的校验规则是：</p>
<ul>
<li>name和email应该被填充</li>
<li>name字段不少于2个字符</li>
</ul>
<h3><span id="adding-a-validatio-rules-prop-to-form">Adding a validatio rules prop to form</span></h3>
<p>首先思考如何在表单中指定校验规则。我们需要为一个字段指定一个或多个规则。某些规则可能会有参数，例如最小长度。以如下形式，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Form</span><br><span class="line">  ...</span><br><span class="line">  validationRules=&#123;&#123;</span><br><span class="line">    email: &#123; validator: required &#125;,</span><br><span class="line">	name: [&#123; validator: required &#125;, &#123; validator: minLength, arg: 3 &#125;]</span><br><span class="line">  &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/Form&gt;</span><br></pre></td></tr></table></figure>
<p>首先在<code>Form</code>组件实现一个<code>validationRules</code>属性，</p>
<ol>
<li>在<code>Form.tsx</code>中定义一个<code>Validator</code>函数：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export type Validator= (</span><br><span class="line">  fieldName: string,</span><br><span class="line">  values: IValues,</span><br><span class="line">  args?: any</span><br><span class="line">) =&gt; string;</span><br></pre></td></tr></table></figure>
<p>一个<code>Validator</code>函数包含字段名、值、以及一个可选参数，并返回string的字符串消息。如果输入内容合法，则返回空字符串。</p>
<ol start="2">
<li>下面使用该类型创建一个<code>required</code>函数，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export const required: Validator = (</span><br><span class="line">  fieldName: string,</span><br><span class="line">  values: IValues,</span><br><span class="line">  args?: any</span><br><span class="line">): string =&gt;</span><br><span class="line">  values[fieldName] === undefined ||</span><br><span class="line">  values[fieldName] === null ||</span><br><span class="line">  values[fieldName] === &quot;&quot;</span><br><span class="line">    ? &quot;This must be populated&quot;</span><br><span class="line">	: &quot;&quot;;</span><br></pre></td></tr></table></figure>
<p>这里需要将这个函数对外暴露使用。该函数会检测字段值是<code>undefined</code>、<code>null</code>还是空字符串，如果是则返回<code>This must be populated</code>的错误信息。</p>
<ol start="3">
<li>类似地，创建一个长度判断的函数，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export const minLength: Validator = (</span><br><span class="line">  fieldName: string,</span><br><span class="line">  values: IValues,</span><br><span class="line">  length: number</span><br><span class="line">): string =&gt;</span><br><span class="line">  values[fieldName] &amp;&amp; values[fieldName].length &lt; length ? `This must be at least $&#123;length&#125; characters`</span><br><span class="line">  : &quot;&quot;;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>接下来需要创建传递这些规则的props，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface IValidation &#123;</span><br><span class="line">  validator: Validator;</span><br><span class="line">  arg?: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IValidationProp &#123;</span><br><span class="line">  [key: string]: IValidation | IValidation[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IFormProps &#123;</span><br><span class="line">  defaultValues: IValues;</span><br><span class="line">  validationRules: IValidationProp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>validationRules</code>是一个索引key/value类型，其中key是字段名，value是一个或多个验证规则。</li>
<li>一个校验规则包含函数类型和一个参数。</li>
</ul>
<ol start="5">
<li>有了<code>validationRules</code>后，在<code>ContactUs</code>中添加，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Form, minLenght, requied &#125; from &quot;./Forma&quot;;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>现在，添加校验规则到<code>ContactUs</code>组件中，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Form defaultValues=&#123;&#123; name: &quot;&quot;, email: &quot;&quot;, reason: &quot;Support&quot;, notes: &quot;&quot; &#125;&#125;</span><br><span class="line">  valiationRules=&#123;&#123;</span><br><span class="line">    email: &#123; validator: required &#125;,</span><br><span class="line">	name: [&#123; validator: required &#125;, &#123; validator: minLength, arg: 2 &#125;]</span><br><span class="line">  &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/Form&gt;</span><br></pre></td></tr></table></figure>
<h3><span id="tracking-validation-error-messages">Tracking validation error messages</span></h3>
<p>有必要跟踪用户的不合法输入信息，提供友好的用户体验。</p>
<p><code>Form</code>组件的职责用于管理表单状态，因此将错误信息添加到state中，</p>
<ol>
<li>定义错误信息类型，添加到<code>IState</code>中，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface IErrors &#123;</span><br><span class="line">  [key: string]: string[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IState &#123;</span><br><span class="line">  values: IValues;</span><br><span class="line">  errors: IErrors;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>errors</code>是一个key/value键值对，key为字段名，value为一组错误消息。</p>
<ol start="2">
<li>在构造器中初始化<code>errors</code>的状态，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">constructor(props: IFormProps) &#123;</span><br><span class="line">  super(props);</span><br><span class="line">  const errors: IErrors = &#123;&#125;;</span><br><span class="line">  Object.keys(props.defaultValues).forEach(fieldName =&gt; &#123;</span><br><span class="line">    errors[fieldName] = [];</span><br><span class="line">  &#125;);</span><br><span class="line">  this.state = &#123;</span><br><span class="line">    errors,</span><br><span class="line">    values: props.defaultValues</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认的<code>defaultValues</code>包含了所有字段名。当<code>Form</code>组件初始化，所有字段的错误信息为空。</p>
<ol start="3">
<li><code>Field</code>组件最终被用于渲染校验的错误信息，因此需要将这些信息添加到表单上下文。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface IFormContext &#123;</span><br><span class="line">  errors: IErrors;</span><br><span class="line">  values: IValues;</span><br><span class="line">  setValue?: (fieldName: string, value: any) =&gt; void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>添加一个空白的<code>error</code>字面量作为默认值。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const FormContext = React.createContext&lt;IFormContext&gt;(&#123;</span><br><span class="line">  errors: &#123;&#125;,</span><br><span class="line">  values: &#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>现在加入到context中，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public render() &#123;</span><br><span class="line">  const context: IFormContext = &#123;</span><br><span class="line">    errors: this.state.errors,</span><br><span class="line">	setValue: this.setValue,</span><br><span class="line">	values: this.state.values</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    ...</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，校验错误信息被设置在state中，并且可以被<code>Field</code>组件访问。接下来要创建一个方法来调用这些校验规则。</p>
<h3><span id="invoking-validation-rules">Invoking validation rules</span></h3>
<p>前面定义了校验规则，并且将校验信息关联到state中。但这些规则还没被调用。接下来我们要实现：</p>
<ol>
<li>我们需要在<code>Form</code>组件内创建一个方法，使用这些规则来校验字段。我们创建一个<code>validate</code>方法，它接收字段名和它的值。该方法会返回一个error message的数组信息，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private validate = (</span><br><span class="line">  fieldName: string,</span><br><span class="line">  value: any</span><br><span class="line">): string[] =&gt; &#123;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>方法内，需要获取校验规则，并初始化返回信息<code>errors</code>。我们会收集校验的错误信息并存储在<code>errors</code>中。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private validate = (</span><br><span class="line">  fieldName: string,</span><br><span class="line">  value: any</span><br><span class="line">): string[] =&gt; &#123;</span><br><span class="line">  const rules = this.props.validationRules[fieldName];</span><br><span class="line">  const errors: string[] = [];</span><br><span class="line">  </span><br><span class="line">  // TODO - execute all the validators</span><br><span class="line">  return errors;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>上下文获取的规则可能是一个<code>IValidation</code>数组，也可能是一个<code>IValidation</code>对象。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const errors: string[] = [];</span><br><span class="line">if (Array.isArray(rules)) &#123;</span><br><span class="line">  // TODO - execute all the validators in the array of rules</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  if (rules) &#123;</span><br><span class="line">    const error = rules.validator(fieldName, this.state.values, rules.arg);</span><br><span class="line">	if (error) &#123;</span><br><span class="line">	  errors.push(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">return errors;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>有多个校验规则时，我们可以使用<code>forEach</code>函数迭代执行，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if (Array.isArray(rules)) &#123;</span><br><span class="line">  rules.forEach(rule =&gt; &#123;</span><br><span class="line">    const error = rule.validator(</span><br><span class="line">	  fieldNmae,</span><br><span class="line">	  this.state.values,</span><br><span class="line">	  rule.arg</span><br><span class="line">    );</span><br><span class="line">	if (error) &#123;</span><br><span class="line">	  errors.push(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">return errors;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>剩下的代码部分是，将校验的结果存储到表单状态<code>errors</code>中。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if (Array.isArray(rules)) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">const newErrors = &#123; ...this.state.errors, [fieldName]: errors &#125;;</span><br><span class="line">this.setState(&#123; errors: newErrors &#125;);</span><br><span class="line">return errors;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>表单<code>Field</code>组件需要调用到这个<code>validate</code>方法。首先添加到<code>IFormContext</code>接口，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface IFormContext &#123;</span><br><span class="line">  values: IValues;</span><br><span class="line">  errors: IErrors;</span><br><span class="line">  setValue?: (fieldName: string, value: any) =&gt; void;</span><br><span class="line">  validate?: (fieldName: string, value: any) =&gt; void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>现在将它添加到<code>Form</code>渲染内容中，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public render() &#123;</span><br><span class="line">  const context: IFormContext = &#123;</span><br><span class="line">    errors: this.state.errors,</span><br><span class="line">	setValue: this.setValue,</span><br><span class="line">	validate: this.validate,</span><br><span class="line">	values: this.state.values</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    ...</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>表单的校验和方法的调用已经完成了。但没有事件触发这个动作，</p>
<h3><span id="triggering-validation-rule-execution-from-field">TRiggering validation rule execution from field</span></h3>
<p>当用户输入表单内容后，我们希望校验规则在blur时触发，</p>
<ol>
<li>首先创建一个函数处理这些输入框触发的<code>blur</code>事件，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const handleChange = (</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const handleBlur = (</span><br><span class="line">  e:</span><br><span class="line">    | React.FocusEvent&lt;HTMLInputElement&gt;</span><br><span class="line">	| React.FocusEvent&lt;HTMLTextAreaElement&gt;</span><br><span class="line">	| React.FocusEvent&lt;HTMLSelectElement&gt;,</span><br><span class="line">  context: IFormContext</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  if (context.validate) &#123;</span><br><span class="line">    context.validate(props.name, e.currentTarget.value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">return ( ... )</span><br></pre></td></tr></table></figure>
<ul>
<li>TypeScript的blur事件是<code>FocusEvent&lt;T&gt;</code>，其中<code>T</code>是被处理的元素。</li>
<li>参数<code>e</code>作为事件对象。</li>
<li>第二个参数是表单上下文。</li>
<li>需要使用条件语句判断<code>validate</code>方法是否定义。</li>
<li>方法体内调用<code>valdiate</code>方法。</li>
</ul>
<ol start="2">
<li>将事件引入，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;(type === &quot;Text&quot; || type === &quot;Email&quot;) &amp;&amp; (</span><br><span class="line">&lt;input</span><br><span class="line">type=&#123;type.toLowerCase()&#125;</span><br><span class="line">id=&#123;name&#125;</span><br><span class="line">value=&#123;context.values[name]&#125;</span><br><span class="line">onChange=&#123;e =&gt; handleChange(e, context)&#125;</span><br><span class="line">onBlur=&#123;e =&gt; handleBlur(e, context)&#125;</span><br><span class="line">/&gt;</span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>类似地，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;type === &quot;TextArea&quot; &amp;&amp; (</span><br><span class="line">&lt;textarea</span><br><span class="line">id=&#123;name&#125;</span><br><span class="line">value=&#123;context.values[name]&#125;</span><br><span class="line">onChange=&#123;e =&gt; handleChange(e, context)&#125;</span><br><span class="line">onBlur=&#123;e =&gt; handleBlur(e, context)&#125;</span><br><span class="line">/&gt;</span><br><span class="line">)&#125;</span><br><span class="line">&#123;type === &quot;Select&quot; &amp;&amp; (</span><br><span class="line">&lt;select</span><br><span class="line">value=&#123;context.values[name]&#125;</span><br><span class="line">onChange=&#123;e =&gt; handleChange(e, context)&#125;</span><br><span class="line">onBlur=&#123;e =&gt; handleBlur(e, context)&#125;</span><br><span class="line">&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure>
<p>输入框字段会在失去焦点时触发校验动作。</p>
<h3><span id="rendering-validation-error-messages">Rendering validation error messages</span></h3>
<p>在此之前，需要将错误信息展示或者隐藏。</p>
<ol>
<li>添加<code>form-error</code>样式控制，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">  &lt;label htmlFor=&#123;name&#125;&gt;&#123;label&#125;&lt;/label&gt;</span><br><span class="line">  &#123;(type === &quot;Text&quot; || type === &quot;Email&quot;) &amp;&amp; (</span><br><span class="line">    ...</span><br><span class="line">  )&#125;</span><br><span class="line">  &#123;type === &quot;TextArea&quot; &amp;&amp; (</span><br><span class="line">    ...</span><br><span class="line">  )&#125;</span><br><span class="line">  &#123;type === &quot;Select&quot; &amp;&amp; (</span><br><span class="line">    ...</span><br><span class="line">  )&#125;</span><br><span class="line">&#123;context.errors[name] &amp;&amp;</span><br><span class="line">  context.errors[name].length &gt; 0 &amp;&amp;</span><br><span class="line">  context.errors[name].map(error =&gt; (</span><br><span class="line">    &lt;span key=&#123;error&#125; className=&quot;form-error&quot;&gt;</span><br><span class="line">       &#123;error&#125;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">  ))&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>首先检测有错误的字段，再将错误信息渲染出来。</p>
<ol start="2">
<li>下面是css样式，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.form-error &#123;</span><br><span class="line">font-size: 13px;</span><br><span class="line">color: red;</span><br><span class="line">margin: 3px auto 0px 0px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="form-submission">Form submission</span></h2>
<p>表单触发提交动作时，同样也需要进行校验。</p>
<ol>
<li>首先添加提交按钮，在<code>Form</code>组件中添加，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;FormContext.Provider value=&#123;context&#125;&gt;</span><br><span class="line">  &lt;form className=&quot;form&quot; noValidate=&#123;true&#125;&gt;</span><br><span class="line">    &#123;this.props.children&#125;</span><br><span class="line">	&lt;div className=&quot;form-group&quot;&gt;</span><br><span class="line">	  &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/FormContext.Provider&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>给按钮添加样式，</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.form-group</span> <span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line">  <span class="attribute">border</span>: black solid <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: black;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.form-group</span> <span class="selector-tag">button</span><span class="selector-pseudo">:disabled</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: gray solid <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: gray;</span><br><span class="line">  <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="adding-a-onsubmit-form-prop">Adding a onSubmit form prop</span></h3>
<p>在我们的<code>Form</code>组件中，需要一个新的属性来消费表单的提交动作。</p>
<ol>
<li>在<code>Form</code>组件中创建一个prop函数，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export interface ISubmitResult &#123;</span><br><span class="line">  success: boolean;</span><br><span class="line">  errors?: IErrors;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IFormProps &#123;</span><br><span class="line">  defaultValues: IValues;</span><br><span class="line">  validationRules: IValidationProp;</span><br><span class="line">  onSubmit: (values: IValues) =&gt; Promise&lt;ISubmitResult&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>onSubmit</code>函数会接收filed的值，并异步返回提交的信息。</p>
<ol start="2">
<li>另外需要添加状态记录表单的提交动作，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface IState &#123;</span><br><span class="line">  values: IValues;</span><br><span class="line">  errors: IErrors;</span><br><span class="line">  submitting: boolean;</span><br><span class="line">  submitted: boolean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>另外需要在构造器初始化，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">constructor(props: IFormProps) &#123;</span><br><span class="line">  ...</span><br><span class="line">  this.state = &#123;</span><br><span class="line">    errors,</span><br><span class="line">	submitted: false,</span><br><span class="line">	submitting: false,</span><br><span class="line">	values: props.defaultValues</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>表单提交后按钮不可用，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;button type=&quot;submit&quot;</span><br><span class="line">  disabled=&#123;this.state.submitting || this.state.submitted&#125;</span><br><span class="line">&gt;</span><br><span class="line">  Submit</span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>在表单中添加事件控制，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form className=&quot;form&quot; noValidate=&#123;true&#125; onSubmit=&#123;this.handleSubmit&#125;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>下面模拟这个提交动作，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private handleSubmit = async (e: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; &#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这里使用了<code>preventDefault</code>避免浏览器自动提交。</p>
<ol start="7">
<li>接下来就是重点，表单验证！</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">private validateForm(): boolean &#123;</span><br><span class="line">  const errors: IErrors = &#123;&#125;;</span><br><span class="line">  let haveError: boolean = false;</span><br><span class="line">  Object.keys(this.props.defaultValues).map(fieldName =&gt; &#123;</span><br><span class="line">    errors[fieldName] = this.validate(</span><br><span class="line">      fieldName,</span><br><span class="line">      this.state.values[fieldName]</span><br><span class="line">    );</span><br><span class="line">    if (errors[fieldName].length &gt; 0) &#123;</span><br><span class="line">      haveError = true;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  this.setState(&#123; errors &#125;);</span><br><span class="line">  return !haveError;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private handleSubmit = async (e: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; &#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  if (this.validateForm()) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>表单的状态会更新到最新的校验错误信息，</p>
<ol start="8">
<li>实现剩余的代码，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private handleSubmit = async (e: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; &#123; </span><br><span class="line">  e.preventDefault();</span><br><span class="line">  if (this.validateForm()) &#123;</span><br><span class="line">    this.setState(&#123; submitting: true &#125;);</span><br><span class="line">    const result = await this.props.onSubmit(this.state.values);</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      errors: result.errors || &#123;&#125;,</span><br><span class="line">      submitted: result.success,</span><br><span class="line">      submitting: false</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3><span id="consuming-the-onsubmit-form-prop">Consuming the onSubmit form prop</span></h3>
<p>在本小节，将实现如何消费表单的提交内容。</p>
<ol>
<li>首先在<code>ContactUs</code>组件中导入<code>ISubmitResult</code>和<code>IValues</code>，用于处理提交的内容，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Form, ISubmitResult, IValues, minLength, required &#125; from &quot;./Form&quot;;</span><br><span class="line"></span><br><span class="line">interface IProps &#123;</span><br><span class="line">  onSubmit: (values: IValues) =&gt; Promise&lt;ISubmitResult&gt;;</span><br><span class="line">&#125;</span><br><span class="line">const ContactUs: React.SFC&lt;IProps&gt; = props =&gt; &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>创建一个<code>handleSubmit</code>函数，它将会调用<code>onSubmit</code>属性，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const ContactUs: React.SFC&lt;IProps&gt; = props =&gt; &#123;</span><br><span class="line">  const handleSubmit = async (values: IValues): Promise&lt;ISubmitResult&gt; =&gt; &#123;</span><br><span class="line">    const result = await props.onSubmit(values);</span><br><span class="line">	return result;</span><br><span class="line">  &#125;;</span><br><span class="line">  return ( ... );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>onSubmit</code>属性是异步的，因此需要函数前缀带<code>async</code>以及<code>onSubmit</code>前面带<code>await</code>。</p>
<ol start="3">
<li>绑定这个属性，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">return (</span><br><span class="line">  &lt;Form ... onSubmit=&#123;handleSubmit&#125;&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;/Form&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>现在移步到<code>ContactUsPage</code>组件，创建提交处理，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">private handleSubmit = async (values: IValues): Promise&lt;ISubmitResult&gt; =&gt; &#123;</span><br><span class="line">  await wait(1000); // simulate asynchronous web API call</span><br><span class="line">  return &#123;</span><br><span class="line">    errors: &#123;</span><br><span class="line">	  email: [&quot;Some is wrong with this&quot;]</span><br><span class="line">    &#125;,</span><br><span class="line">	success: false</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>接着创建<code>wait</code>函数，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const wait = (ms: number): Promise&lt;void&gt; =&gt; &#123;</span><br><span class="line">  return new Promise(resolve =&gt; setTimeout(resolve, ms));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>在<code>ContactUs</code>组件中加上，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ContactUs onSubmit=&#123;this.handleSubmit&#125; /&gt;</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>导入暴露的属性，</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ISubmitResult, IValues &#125; from &quot;./Form&quot;;</span><br></pre></td></tr></table></figure>
<h2><span id="summary">Summary</span></h2>
<p>本章讨论了控制组件，通过实现自定义表单组件描述。我们构建了一个通用型的<code>Form</code>和<code>Field</code>组件，并实现了状态控制、事件处理、表单提交等操作。</p>
<h2><span id="questions">Questions</span></h2>
<p>问题练习：</p>
<ol>
<li>扩展<code>Field</code>组件内容，包含<code>number</code>属性。</li>
<li>实现一个的输入框，该输入框响应紧急的程度，用数字表示。</li>
<li>实现一个新的校验函数，检测输入的数字是否在区间范围内。</li>
<li>合并实现2和3的功能。</li>
<li>为这个输入框添加事件。</li>
</ol>
</div></article><div id="base-discus"><div id="disqus_thread"></div><script>var disqus_shortname = 'barudisshu-github-io';
var disqus_identifier = '2019/11/27/react-ts/chapter_7_Working_with_Forms/';
var disqus_title = '第七章 表单';
var disqus_url = 'http://galudisu.info/2019/11/27/react-ts/chapter_7_Working_with_Forms/';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//barudisshu-github-io.disqus.com/count.js" async>  </script></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>©2016 - 2020 <a href="http://galudisu.info">barudisshu</a>, unless otherwise noted.</span></div></footer><div class="dom-ready"><script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.min.css"><script src="/js/base.js"></script><script src="/js/rabbit-lyrics.js"></script></div><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>